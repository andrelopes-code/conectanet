<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8" />
        <title>ConectaNet</title>
        <link rel="stylesheet" href="style.css" />
    </head>
    <body id="preview">
        <h1 class="code-line" data-line-start="0" data-line-end="1">
            <a id="ConectaNet_0"></a>ConectaNet
        </h1>
        <hr>
        <h2 class="code-line" data-line-start="2" data-line-end="3">
            <a id="Configurao_Bsica_2"></a>Configuração Básica
        </h2>
        <blockquote>
            <p class="has-line-data" data-line-start="4" data-line-end="5">
                Este documento fornece uma visão geral das configurações e
                serviços implementados no servidor, incluindo firewall, proxy,
                DHCP e Active Directory. Esperamos que esta documentação seja
                útil para administradores de sistemas e equipe de suporte de TI
                na gestão eficaz do ambiente de servidores da ConectaNet.
            </p>
        </blockquote>
        <h3 class="code-line" data-line-start="6" data-line-end="7">
            <a id="Informaes_da_Mquina_6"></a>Informações da Máquina
        </h3>
        <ul>
            <li class="has-line-data" data-line-start="7" data-line-end="8">
                <strong>Nome da máquina:</strong> srv-cnet
            </li>
            <li class="has-line-data" data-line-start="8" data-line-end="9">
                <strong>Sistema operacional:</strong> ubuntu server 16.04 LTS
            </li>
            <li class="has-line-data" data-line-start="9" data-line-end="10">
                <strong>Nome de usuário:</strong> conectanet
            </li>
            <li class="has-line-data" data-line-start="10" data-line-end="12">
                <strong>Senha:</strong>
                ConectaNet@2023.2
            </li>
        </ul>
        <h3 class="code-line" data-line-start="12" data-line-end="13">
            <a id="Configurao_de_Rede_12"></a>Configuração de Rede
        </h3>
        <ul>
            <li class="has-line-data" data-line-start="13" data-line-end="14">
                <strong>Endereço da rede:</strong> 192.168.0.0/24
            </li>
            <li class="has-line-data" data-line-start="14" data-line-end="15">
                <strong>Endereço do servidor:</strong> 192.168.0.254
            </li>
            <li class="has-line-data" data-line-start="15" data-line-end="16">
                <strong>Interfaces de rede:</strong> eno1, enp2s0
            </li>
            <li class="has-line-data" data-line-start="16" data-line-end="18">
                <strong>Domínio:</strong> conectanet.lan
            </li>
        </ul>
        <h3 class="code-line" data-line-start="18" data-line-end="19">
            <a id="Servios_e_Aplicativos_Instalados_18"></a>Serviços e
            Aplicativos Instalados
        </h3>
        <ul>
            <li class="has-line-data" data-line-start="19" data-line-end="20">
                <strong>Firewall:</strong> Utilizamos o iptables para garantir a
                segurança do servidor e controlar o tráfego de rede.
            </li>
            <li class="has-line-data" data-line-start="20" data-line-end="21">
                <strong>Proxy:</strong> O servidor squid atua como proxy,
                melhorando o desempenho e a segurança das conexões à internet.
            </li>
            <li class="has-line-data" data-line-start="21" data-line-end="22">
                <strong>DHCP:</strong> Utilizamos o isc-dhcp-server para
                gerenciar a atribuição dinâmica de endereços IP na nossa rede
                local.
            </li>
            <li class="has-line-data" data-line-start="22" data-line-end="24">
                <strong>AD:</strong> Configuramos o samba-ad-dc para
                autenticação centralizada e gerenciamento de usuários.
            </li>
        </ul>
        <br />
        <h3 class="code-line" data-line-start="26" data-line-end="27">
            <a id="Atualizao_dos_pacotes_do_sistema_26"></a>Atualização dos
            pacotes do sistema
        </h3>
        <p class="has-line-data" data-line-start="27" data-line-end="28">
            Para garantir que o sistema esteja atualizado, execute os seguintes
            comandos:
        </p>
        <pre><code class="has-line-data" data-line-start="29" data-line-end="32" class="language-bash">sudo apt update
sudo apt upgrade -y
</code></pre>
        <br />
        <h3 class="code-line" data-line-start="35" data-line-end="36">
            <a id="Configurao_do_arquivo_etchosts_35"></a>Configuração do
            arquivo <code>/etc/hosts</code>
        </h3>
        <p class="has-line-data" data-line-start="36" data-line-end="37">
            Edite o arquivo <code>/etc/hosts</code> com o seguinte conteúdo:
        </p>
        <pre><code class="has-line-data" data-line-start="38" data-line-end="40" class="language-bash">sudo vi /etc/hosts
</code></pre>
        <h4 class="code-line" data-line-start="41" data-line-end="42">
            <a id="Contedo_do_arquivo_41"></a>Conteúdo do arquivo:
        </h4>
        <pre><code class="has-line-data" data-line-start="43" data-line-end="46" class="language-bash"><span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span>       localhost
<span class="hljs-number">192.168</span>.<span class="hljs-number">0.254</span>   srv-cnet.conectanet.lan srv-cnet
</code></pre>
        <br />
        <h3 class="code-line" data-line-start="49" data-line-end="50">
            <a id="Configurao_das_interfaces_de_rede_49"></a>Configuração das
            interfaces de rede
        </h3>
        <p class="has-line-data" data-line-start="50" data-line-end="51">
            Edite o arquivo <code>/etc/network/interfaces</code> com o seguinte
            conteúdo:
        </p>
        <pre><code class="has-line-data" data-line-start="52" data-line-end="54" class="language-bash">sudo vi /etc/network/interfaces
</code></pre>
        <h4 class="code-line" data-line-start="55" data-line-end="56">
            <a id="Contedo_do_arquivo_55"></a>Conteúdo do arquivo:
        </h4>
        <pre><code class="has-line-data" data-line-start="57" data-line-end="72" class="language-bash"><span class="hljs-comment"># Interface de rede externa</span>
auto eno1
iface eno1 inet dhcp

<span class="hljs-comment"># Interface de rede interna</span>
auto enp2s0
iface enp2s0 inet static
        address <span class="hljs-number">192.168</span>.<span class="hljs-number">0.254</span>
        netmask <span class="hljs-number">255.255</span>.<span class="hljs-number">255.0</span>
        network <span class="hljs-number">192.168</span>.<span class="hljs-number">0.0</span>
        broadcast <span class="hljs-number">192.168</span>.<span class="hljs-number">0.255</span>
        dns-nameservers <span class="hljs-number">192.168</span>.<span class="hljs-number">0.254</span> <span class="hljs-number">8.8</span>.<span class="hljs-number">8.8</span>
        dns-search conectanet.lan
        dns-domain conectanet.lan
</code></pre>
        <h4 class="code-line" data-line-start="73" data-line-end="74">
            <a id="Reinicie_a_interface_de_rede_73"></a>Reinicie a interface de
            rede
        </h4>
        <pre><code class="has-line-data" data-line-start="75" data-line-end="78" class="language-bash">sudo ifdown enp2s0
sudo ifup enp2s0
</code></pre>
        <br />
        <h3 class="code-line" data-line-start="81" data-line-end="82">
            <a id="Configurao_manual_de_resoluo_de_DNS_81"></a>Configuração
            manual de resolução de DNS
        </h3>
        <pre><code class="has-line-data" data-line-start="83" data-line-end="88" class="language-bash">sudo systemctl <span class="hljs-built_in">disable</span> --now systemd-resolved
sudo unlink /etc/resolv.conf
sudo touch /etc/resolv.conf
sudo vi /etc/resolv.conf
</code></pre>
        <h4 class="code-line" data-line-start="89" data-line-end="90">
            <a id="Contedo_do_arquivo_89"></a>Conteúdo do arquivo:
        </h4>
        <pre><code class="has-line-data" data-line-start="92" data-line-end="99" class="language-bash"><span class="hljs-comment"># Endereço do controlador de domínio Samba</span>
nameserver <span class="hljs-number">192.168</span>.<span class="hljs-number">0.254</span>
<span class="hljs-comment"># Endereço de fallback</span>
nameserver <span class="hljs-number">8.8</span>.<span class="hljs-number">8.8</span>
<span class="hljs-comment"># Domínio de pesquisa para resolução de nomes</span>
search conectanet.lan
</code></pre>
        <h4 class="code-line" data-line-start="100" data-line-end="101">
            <a id="Adicione_o_atributo_de_imutabilidade_100"></a>Adicione o
            atributo de imutabilidade:
        </h4>
        <pre><code class="has-line-data" data-line-start="103" data-line-end="105" class="language-bash">sudo chattr +i /etc/resolv.conf
</code></pre>
        <br />
        <h2 class="code-line" data-line-start="108" data-line-end="109">
            <a id="Firewall_Iptables_108"></a>Firewall Iptables
        </h2>
        <h3 class="code-line" data-line-start="110" data-line-end="111">
            <a id="Arquivo_de_script_das_regras_do_firewall_Iptables_110"></a
            >Arquivo de script das regras do firewall (Iptables)
        </h3>
        <h4 class="code-line" data-line-start="112" data-line-end="113">
            <a id="contedo_do_arquivo_firewall_112"></a>conteúdo do arquivo
            <code>firewall</code>:
        </h4>
        <pre><code class="has-line-data" data-line-start="114" data-line-end="243" class="language-bash"><span class="hljs-shebang">#!/bin/bash
</span>
<span class="hljs-comment"># Variaveis locais</span>
ext=<span class="hljs-string">"eno1"</span>              <span class="hljs-comment"># Interface de rede externa</span>
int=<span class="hljs-string">"enp2s0"</span>            <span class="hljs-comment"># Interface de rede interna</span>
lnet=<span class="hljs-string">"192.168.0.0/24"</span>   <span class="hljs-comment"># Endereço da rede local</span>
server=<span class="hljs-string">"192.168.0.254"</span>  <span class="hljs-comment"># Endereço do servidor                </span>

<span class="hljs-comment">#  Funcoes para definicao de regras</span>

<span class="hljs-function"><span class="hljs-title">local</span></span>(){
    <span class="hljs-comment"># Funcao para configuracao das regras de firewall para comunicacao local</span>

    <span class="hljs-comment"># Permite trafego TCP e UDP de entrada e saida nas portas</span>
    <span class="hljs-comment"># 80, 443, 53, 123 (HTTP, HTTPS, DNS, NTP)</span>
    iptables -t filter -A INPUT -i <span class="hljs-variable">$ext</span> -p tcp -m multiport --sports <span class="hljs-number">80</span>,<span class="hljs-number">443</span> -j ACCEPT
    iptables -t filter -A INPUT -i <span class="hljs-variable">$ext</span> -p udp -m multiport --sports <span class="hljs-number">53</span>,<span class="hljs-number">123</span> -j ACCEPT
    iptables -t filter -A OUTPUT -o <span class="hljs-variable">$ext</span> -p tcp -m multiport --dports <span class="hljs-number">80</span>,<span class="hljs-number">443</span> -j ACCEPT
    iptables -t filter -A OUTPUT -o <span class="hljs-variable">$ext</span> -p udp -m multiport --dports <span class="hljs-number">53</span>,<span class="hljs-number">123</span> -j ACCEPT

    <span class="hljs-comment"># Libera todo o trafego da lo</span>
    iptables -t filter -A INPUT -i lo -j ACCEPT
    iptables -t filter -A OUTPUT -o lo -j ACCEPT

    <span class="hljs-comment"># Libera o ping (ICMP) na rede externa</span>
    iptables -t filter -A INPUT -i <span class="hljs-variable">$ext</span> -p icmp --icmp-type <span class="hljs-number">0</span> -j ACCEPT
    iptables -t filter -A OUTPUT -o <span class="hljs-variable">$ext</span> -p icmp --icmp-type <span class="hljs-number">8</span> -j ACCEPT

    <span class="hljs-comment"># Libera o ping (ICMP) na rede interna</span>
    iptables -t filter -A INPUT -i <span class="hljs-variable">$int</span> -p icmp --icmp-type <span class="hljs-number">0</span> -j ACCEPT
    iptables -t filter -A OUTPUT -o <span class="hljs-variable">$int</span> -p icmp --icmp-type <span class="hljs-number">8</span> -j ACCEPT

    <span class="hljs-comment"># Libera o trafego TCP do Squid (3128)</span>
    iptables -t filter -A INPUT -i <span class="hljs-variable">$int</span> -p tcp --dport <span class="hljs-number">3128</span> -j ACCEPT
    iptables -t filter -A OUTPUT -o <span class="hljs-variable">$int</span> -p tcp --sport <span class="hljs-number">3128</span> -j ACCEPT

    <span class="hljs-comment"># libera a porta SSH (22) para um IP confiavel</span>
    iptables -t filter -A INPUT -p tcp --dport <span class="hljs-number">22</span> <span class="hljs-operator">-s</span> <span class="hljs-number">0.0</span>.<span class="hljs-number">0.0</span> -j ACCEPT
    iptables -t filter -A OUTPUT -p tcp --sport <span class="hljs-number">22</span> <span class="hljs-operator">-d</span> <span class="hljs-number">0.0</span>.<span class="hljs-number">0.0</span> -j ACCEPT

    <span class="hljs-comment"># Libera trafego nas portas do Samba (135, 137, 138, 139 e 445)</span>
    sambaports=<span class="hljs-string">"135,137,138,139,445"</span>
    iptables -t filter -A INPUT <span class="hljs-operator">-s</span> <span class="hljs-variable">$lnet</span> -p tcp -m multiport --dports <span class="hljs-variable">$sambaports</span> -j ACCEPT
    iptables -t filter -A INPUT <span class="hljs-operator">-s</span> <span class="hljs-variable">$lnet</span> -p udp -m multiport --sports <span class="hljs-variable">$sambaports</span> -j ACCEPT
    iptables -t filter -A OUTPUT <span class="hljs-operator">-s</span> <span class="hljs-variable">$lnet</span> -p tcp -m multiport --sports <span class="hljs-variable">$sambaports</span> -j ACCEPT
    iptables -t filter -A OUTPUT <span class="hljs-operator">-s</span> <span class="hljs-variable">$lnet</span> -p udp -m multiport --sports <span class="hljs-variable">$sambaports</span> -j ACCEPT

    <span class="hljs-comment"># Permite portas para o funcionamento do samba-ad-dc</span>
    samba_ad_dc_tcp=<span class="hljs-string">"53,88,135,139,389,445,464,636,1024:5000,49152:65535,3268,3269,5353"</span>
    samba_ad_dc_udp=<span class="hljs-string">"53,88,137,138,389,5353"</span>
    iptables -A INPUT <span class="hljs-operator">-s</span> <span class="hljs-variable">$lnet</span> -p tcp -m multiport --dports <span class="hljs-variable">$samba_ad_dc_tcp</span> -j ACCEPT
    iptables -A INPUT <span class="hljs-operator">-s</span> <span class="hljs-variable">$lnet</span> -p udp -m multiport --dports <span class="hljs-variable">$samba_ad_dc_udp</span> -j ACCEPT

    <span class="hljs-comment"># Permitor portas do DNS e HTTP para o servidor </span>
    iptables -A INPUT <span class="hljs-operator">-d</span> <span class="hljs-variable">$server</span> -p tcp --sport <span class="hljs-number">80</span> -j ACCEPT
    iptables -A INPUT <span class="hljs-operator">-d</span> <span class="hljs-variable">$server</span> -p tcp --sport <span class="hljs-number">53</span> -j ACCEPT
    iptables -A INPUT <span class="hljs-operator">-d</span> <span class="hljs-variable">$server</span> -p udp --sport <span class="hljs-number">53</span> -j ACCEPT
    iptables -t filter -A INPUT -p tcp -m state --state ESTABLISHED,RELATED -j ACCEPT
    iptables -t filter -A OUTPUT -p tcp -m state --state ESTABLISHED,RELATED -j ACCEPT
}

<span class="hljs-function"><span class="hljs-title">forward</span></span>(){
    <span class="hljs-comment"># Funcao para encaminhamento de trafego entre WAN e LAN</span>

    <span class="hljs-comment"># Libera o trafego entre a INTERNET e a REDE LOCAL</span>
    iptables -t filter -A FORWARD -i <span class="hljs-variable">$ext</span> -p tcp -m multiport --sports <span class="hljs-number">80</span>,<span class="hljs-number">443</span> <span class="hljs-operator">-d</span> <span class="hljs-variable">$lnet</span> -j ACCEPT
    iptables -t filter -A FORWARD -i <span class="hljs-variable">$ext</span> -p udp -m multiport --sports <span class="hljs-number">53</span>,<span class="hljs-number">123</span> <span class="hljs-operator">-d</span> <span class="hljs-variable">$lnet</span> -j ACCEPT
    iptables -t filter -A FORWARD -i <span class="hljs-variable">$int</span> -p tcp -m multiport --dports <span class="hljs-number">80</span>,<span class="hljs-number">443</span> <span class="hljs-operator">-s</span> <span class="hljs-variable">$lnet</span> -j ACCEPT
    iptables -t filter -A FORWARD -i <span class="hljs-variable">$int</span> -p udp -m multiport --dports <span class="hljs-number">53</span>,<span class="hljs-number">123</span> <span class="hljs-operator">-s</span> <span class="hljs-variable">$lnet</span> -j ACCEPT
    <span class="hljs-comment"># Libera o ping entre a INTERNET e a REDE LOCAL</span>
    iptables -t filter -A FORWARD -i <span class="hljs-variable">$int</span> -p icmp --icmp-type <span class="hljs-number">8</span> <span class="hljs-operator">-s</span> <span class="hljs-variable">$lnet</span> -j ACCEPT
    iptables -t filter -A FORWARD -o <span class="hljs-variable">$int</span> -p icmp --icmp-type <span class="hljs-number">0</span> <span class="hljs-operator">-d</span> <span class="hljs-variable">$lnet</span> -j ACCEPT
    iptables -t filter -A FORWARD -i <span class="hljs-variable">$ext</span> -p icmp --icmp-type <span class="hljs-number">0</span> <span class="hljs-operator">-d</span> <span class="hljs-variable">$lnet</span> -j ACCEPT
    iptables -t filter -A FORWARD -o <span class="hljs-variable">$ext</span> -p icmp --icmp-type <span class="hljs-number">8</span> <span class="hljs-operator">-s</span> <span class="hljs-variable">$lnet</span> -j ACCEPT
}

<span class="hljs-function"><span class="hljs-title">internet</span></span>(){
    <span class="hljs-comment"># Funcao para habilitar o compartilhamento da internet entre as redes</span>

    <span class="hljs-comment"># Habilita o encaminhamento de IP</span>
    sysctl -w net.ipv4.ip_forward=<span class="hljs-number">1</span>
    <span class="hljs-comment"># Configura NAT para o trafego da LAN para a Internet</span>
    iptables -t nat -A POSTROUTING <span class="hljs-operator">-s</span> <span class="hljs-variable">$lnet</span> -o <span class="hljs-variable">$ext</span> -j MASQUERADE
    <span class="hljs-comment"># Direcionar navegacao na porta HTTP (80) para a porta do proxy/squid (3128)</span>
    iptables -t nat -A PREROUTING -i <span class="hljs-variable">$int</span> -p tcp --dport <span class="hljs-number">80</span> -j REDIRECT --to-port <span class="hljs-number">3128</span>
}

<span class="hljs-comment"># Funcoes de controle  </span>

<span class="hljs-function"><span class="hljs-title">default</span></span>() {
    <span class="hljs-comment"># Define a chain de LOGGING que loga e bloqueia os pacotes</span>
    iptables -N LOGGING
    iptables -A LOGGING -m <span class="hljs-built_in">limit</span> --limit <span class="hljs-number">5</span>/min -j LOG --log-prefix <span class="hljs-string">"iptables-denied: "</span> --log-level <span class="hljs-number">7</span>
    iptables -A LOGGING -j DROP
    <span class="hljs-comment"># Redireciona os pacotes sem regra definida para LOGGING</span>
    iptables -t filter -A INPUT -j LOGGING
    iptables -t filter -A OUTPUT -j LOGGING
    iptables -t filter -A FORWARD -j LOGGING
}

<span class="hljs-function"><span class="hljs-title">iniciar</span></span>(){
    <span class="hljs-comment"># Funcao para iniciar o firewall</span>
    <span class="hljs-built_in">local</span>
    forward
    internet
    default
}

<span class="hljs-function"><span class="hljs-title">parar</span></span>(){
    <span class="hljs-comment"># Funcao para parar o firewall</span>
    iptables -t filter -P INPUT ACCEPT
    iptables -t filter -P OUTPUT ACCEPT
    iptables -t filter -P FORWARD ACCEPT
    iptables -t filter -F
    iptables -X
}

<span class="hljs-comment">#  Script para controle do firewall</span>

<span class="hljs-keyword">case</span> <span class="hljs-variable">$1</span> <span class="hljs-keyword">in</span>
    start|Start|START)iniciar;;
    stop|Stop|STOP)parar;;
    restart|Restart|RESTART)parar;iniciar;;
    listar|list)iptables -t filter -nvL;;
    vi|conf)sudo vi /usr/<span class="hljs-built_in">local</span>/sbin/firewall;;
    *)<span class="hljs-built_in">echo</span> <span class="hljs-string">"usage:
    firewall [start|stop|restart|list|vi]"</span>;;
<span class="hljs-keyword">esac</span>
</code></pre>
        <h4 class="code-line" data-line-start="244" data-line-end="245">
            <a id="Tornar_o_script_um_executavel_244"></a>Tornar o script um
            executavel
        </h4>
        <pre><code class="has-line-data" data-line-start="246" data-line-end="248" class="language-bash">sudo chmod +x firewall
</code></pre>
        <h4 class="code-line" data-line-start="249" data-line-end="250">
            <a id="Mover_o_script_para_uma_pasta_do_PATH_249"></a>Mover o script
            para uma pasta do $PATH
        </h4>
        <pre><code class="has-line-data" data-line-start="251" data-line-end="253" class="language-bash">sudo mv firewall /usr/<span class="hljs-built_in">local</span>/sbin
</code></pre>
        <h4 class="code-line" data-line-start="254" data-line-end="255">
            <a id="Criar_o_arquivo_de_servio_para_inicializao_automtica_254"></a
            >Criar o arquivo de serviço para inicialização automática
        </h4>
        <pre><code class="has-line-data" data-line-start="256" data-line-end="258" class="language-bash">sudo vi /lib/systemd/system/firewall.service
</code></pre>
        <h4 class="code-line" data-line-start="259" data-line-end="260">
            <a id="contedo_do_arquivo_259"></a>conteúdo do arquivo:
        </h4>
        <pre><code class="has-line-data" data-line-start="261" data-line-end="275" class="language-bash">[Unit]
Description=Inicializa o script firewall automaticamente.
After=network.target

[Install]
WantedBy=multi-user.target

[Service]
Type=oneshot
ExecStart=/usr/<span class="hljs-built_in">local</span>/sbin/firewall start
ExecStop=/usr/<span class="hljs-built_in">local</span>/sbin/firewall stop
RemainAfterExit=<span class="hljs-literal">true</span>
KillMode=process
</code></pre>
        <h4 class="code-line" data-line-start="276" data-line-end="277">
            <a id="Recarregar_daemons_do_sistema_276"></a>Recarregar daemons do
            sistema
        </h4>
        <pre><code class="has-line-data" data-line-start="278" data-line-end="280" class="language-bash">sudo systemctl daemon-reload
</code></pre>
        <h4 class="code-line" data-line-start="281" data-line-end="282">
            <a id="Ativar_o_servio_do_firewall_281"></a>Ativar o serviço do
            firewall
        </h4>
        <pre><code class="has-line-data" data-line-start="283" data-line-end="285" class="language-bash">sudo systemctl <span class="hljs-built_in">enable</span> firewall.service
</code></pre>
        <br /><br />
        <h2 class="code-line" data-line-start="288" data-line-end="289">
            <a id="Proxy_Squid_288"></a>Proxy Squid
        </h2>
        <h3 class="code-line" data-line-start="290" data-line-end="291">
            <a id="Instalar_o_squid3_e_apache2_290"></a>Instalar o
            <code>squid3</code> e <code>apache2</code>
        </h3>
        <pre><code class="has-line-data" data-line-start="292" data-line-end="294" class="language-bash">sudo apt install squid3 apache2
</code></pre>
        <br />
        <h3 class="code-line" data-line-start="297" data-line-end="298">
            <a id="Configurao_do_squid_297"></a>Configuração do
            <code>squid</code>
        </h3>
        <pre><code class="has-line-data" data-line-start="299" data-line-end="301" class="language-bash">sudo vi /etc/squid/squid.conf
</code></pre>
        <h4 class="code-line" data-line-start="302" data-line-end="303">
            <a id="contedo_do_arquivo_302"></a>conteúdo do arquivo:
        </h4>
        <pre><code class="has-line-data" data-line-start="304" data-line-end="368" class="language-bash"><span class="hljs-comment">#==  ACL's padrao  ==========================================================#</span>
acl SSL_ports port <span class="hljs-number">443</span> <span class="hljs-number">563</span> <span class="hljs-number">873</span>                                                       
acl Safe_ports port <span class="hljs-number">80</span> <span class="hljs-number">21</span> <span class="hljs-number">443</span> <span class="hljs-number">70</span> <span class="hljs-number">210</span> <span class="hljs-number">280</span> <span class="hljs-number">488</span> <span class="hljs-number">445</span> <span class="hljs-number">139</span> <span class="hljs-number">591</span> <span class="hljs-number">777</span> <span class="hljs-number">8080</span> <span class="hljs-number">3128</span>               
acl Safe_ports port <span class="hljs-number">1025</span>-<span class="hljs-number">65535</span>
acl CONNECT method CONNECT

<span class="hljs-comment">#============================================================================#</span>

<span class="hljs-comment"># Diretorio de erros PT|BR</span>
error_directory /usr/share/squid/errors/pt-br
access_<span class="hljs-built_in">log</span> /var/<span class="hljs-built_in">log</span>/squid/access.log

<span class="hljs-comment"># Configuracao de cache de memoria de disco</span>
cache_mem <span class="hljs-number">2500</span> MB
maximum_object_size_<span class="hljs-keyword">in</span>_memory <span class="hljs-number">1</span> MB
cache_<span class="hljs-built_in">log</span> /var/<span class="hljs-built_in">log</span>/squid/cache.log

<span class="hljs-comment"># Definicoes de cache no disco</span>
maximum_object_size <span class="hljs-number">25</span> MB
maximum_object_size <span class="hljs-number">1</span> KB
cache_dir ufs /etc/squid/cache <span class="hljs-number">15360</span> <span class="hljs-number">16</span> <span class="hljs-number">128</span>

<span class="hljs-comment"># Substituicao do cache</span>
cache_swap_low <span class="hljs-number">80</span>
cache_swap_high <span class="hljs-number">90</span>

<span class="hljs-comment"># Sarg</span>
acl sarg dst <span class="hljs-number">192.168</span>.<span class="hljs-number">0.254</span>
http_access allow sarg

<span class="hljs-comment">#==  ACL's  =================================================================#</span>

acl localnet src <span class="hljs-number">192.168</span>.<span class="hljs-number">0.0</span>/<span class="hljs-number">24</span>
acl negados url_regex -i <span class="hljs-string">"/etc/squid/files/negados.acl"</span>

<span class="hljs-comment">#==  DEFAULT HTTP-ACCESS  ===================================================#</span>

http_access deny !Safe_ports
http_access deny CONNECT !SSL_ports
http_access allow localhost manager
http_access deny manager
http_access allow localhost

<span class="hljs-comment">#==  HTTP-ACCESS  ===========================================================#</span>

<span class="hljs-comment"># Permite conexão da rede local, menos para os dominios proibidos</span>
http_access allow localnet !negados

<span class="hljs-comment">#==  DENY ALL  ==============================================================#</span>

http_access deny all

visible_hostname proxy_server
http_port <span class="hljs-number">192.168</span>.<span class="hljs-number">0.254</span>:<span class="hljs-number">3128</span>

<span class="hljs-comment">#============================================================================#</span>

coredump_dir /var/spool/squid
refresh_pattern ^ftp:           <span class="hljs-number">1440</span>    <span class="hljs-number">20</span>%     <span class="hljs-number">10080</span>
refresh_pattern ^gopher:        <span class="hljs-number">1440</span>    <span class="hljs-number">0</span>%      <span class="hljs-number">1440</span>
refresh_pattern -i (/cgi-bin/|\?) <span class="hljs-number">0</span>     <span class="hljs-number">0</span>%      <span class="hljs-number">0</span>
refresh_pattern (Release|Packages(.gz)*)$      <span class="hljs-number">0</span>       <span class="hljs-number">20</span>%     <span class="hljs-number">2880</span>
refresh_pattern .               <span class="hljs-number">0</span>       <span class="hljs-number">20</span>%     <span class="hljs-number">4320</span>
</code></pre>
        <h4 class="code-line" data-line-start="369" data-line-end="370">
            <a id="Pasta_de_cache_do_squid_369"></a>Pasta de cache do
            <code>squid</code>
        </h4>
        <pre><code class="has-line-data" data-line-start="371" data-line-end="381" class="language-bash"><span class="hljs-comment"># Criar a pasta cache</span>
sudo mkdir /etc/squid/cache
<span class="hljs-comment"># Dar permissão total</span>
sudo chmod <span class="hljs-number">777</span> /etc/squid/cache
<span class="hljs-comment"># Parar o Squid</span>
sudo service squid stop
<span class="hljs-comment"># criar o banco de dados de cache do Squid</span>
sudo squid -z
<span class="hljs-comment"># Reinicia o Squid</span>
</code></pre>
        <h4 class="code-line" data-line-start="382" data-line-end="383">
            <a id="Pgina_de_Acesso_Negado_382"></a>Página de Acesso Negado
        </h4>
        <pre><code class="has-line-data" data-line-start="384" data-line-end="386" class="language-bash">sudo vi /usr/share/squid/errors/pt-br/ERR_ACCESS_DENIED
</code></pre>
        <p class="has-line-data" data-line-start="386" data-line-end="387">
            conteúdo do arquivo:
        </p>
        <pre><code class="has-line-data" data-line-start="388" data-line-end="390" class="language-html"># arquivo html da pagina de acesso negado.
</code></pre>
        <h4 class="code-line" data-line-start="391" data-line-end="392">
            <a id="Criar_pasta_files_e_arquivo_negadosacl_391"></a>Criar pasta
            <code>files</code> e arquivo <code>negados.acl</code>
        </h4>
        <pre><code class="has-line-data" data-line-start="393" data-line-end="396" class="language-bash">sudo mkdir /etc/squid/files
sudo touch /etc/squid/files/negados.acl
</code></pre>
        <h4 class="code-line" data-line-start="397" data-line-end="398">
            <a id="Reiniciar_o_squid_397"></a>Reiniciar o <code>squid</code>
        </h4>
        <pre><code class="has-line-data" data-line-start="399" data-line-end="401" class="language-bash">sudo service squid restart
</code></pre>
        <br />
        <h2 class="code-line" data-line-start="404" data-line-end="405">
            <a id="Sarg_404"></a>Sarg
        </h2>
        <h3 class="code-line" data-line-start="405" data-line-end="406">
            <a id="Instalar_o_Sarg_405"></a>Instalar o Sarg
        </h3>
        <pre><code class="has-line-data" data-line-start="407" data-line-end="409" class="language-bash">sudo apt install sarg
</code></pre>
        <br />
        <h3 class="code-line" data-line-start="412" data-line-end="413">
            <a id="Configurao_do_sarg_412"></a>Configuração do <code>sarg</code>
        </h3>
        <pre><code class="has-line-data" data-line-start="414" data-line-end="416" class="language-bash">sudo vi /etc/sarg/sarg.conf
</code></pre>
        <h4 class="code-line" data-line-start="416" data-line-end="417">
            <a id="contedo_do_arquivo_416"></a>conteúdo do arquivo:
        </h4>
        <pre><code class="has-line-data" data-line-start="418" data-line-end="519" class="language-bash"><span class="hljs-comment"># Localização do arquivo de log de acesso do Squid</span>
access_<span class="hljs-built_in">log</span> /var/<span class="hljs-built_in">log</span>/squid/access.log
<span class="hljs-comment"># Título da página de relatórios</span>
title <span class="hljs-string">"Logs de acesso do Squid"</span>
<span class="hljs-comment"># Fonte para o texto</span>
font_face Tahoma,Verdana,Arial
<span class="hljs-comment"># Cor do cabeçalho</span>
header_color <span class="hljs-comment">#000</span>
<span class="hljs-comment"># Cor de fundo do cabeçalho</span>
header_bgcolor <span class="hljs-comment">#c9b2ed</span>
<span class="hljs-comment"># Tamanho da fonte</span>
font_size <span class="hljs-number">14</span>px
<span class="hljs-comment"># Tamanho da fonte do cabeçalho</span>
header_font_size <span class="hljs-number">14</span>px
<span class="hljs-comment"># Tamanho da fonte do título</span>
title_font_size <span class="hljs-number">14</span>px
<span class="hljs-comment"># Cor de fundo do texto</span>
background_color <span class="hljs-comment">#f3f3f3</span>
<span class="hljs-comment"># Cor do texto</span>
text_color <span class="hljs-comment">#000</span>
<span class="hljs-comment"># Cor de fundo do texto</span>
text_bgcolor lavender
<span class="hljs-comment"># Cor do título</span>
title_color <span class="hljs-comment">#966ccc</span>
<span class="hljs-comment"># URL da imagem do logotipo</span>
logo_image https://i.postimg.cc/Gtq5tfNL/logo-transparent.png
<span class="hljs-comment"># Texto do logotipo</span>
logo_text <span class="hljs-string">"ConectaNet Reports"</span>
<span class="hljs-comment"># Cor do texto do logotipo</span>
logo_text_color <span class="hljs-comment">#966ccc</span>
<span class="hljs-comment"># Diretório temporário</span>
temporary_dir /tmp
<span class="hljs-comment"># Diretório de saída dos relatórios</span>
output_dir /var/www/html/squid-reports
<span class="hljs-comment"># Resolver IPs</span>
resolve_ip no
<span class="hljs-comment"># Exibir IPs do usuário</span>
user_ip no
<span class="hljs-comment"># Campo de ordenação para os principais usuários</span>
topuser_sort_field BYTES reverse
<span class="hljs-comment"># Campo de ordenação para os usuários</span>
user_sort_field BYTES reverse
<span class="hljs-comment"># Arquivo de exclusão de usuários</span>
exclude_users /etc/sarg/exclude_users
<span class="hljs-comment"># Arquivo de exclusão de hosts</span>
exclude_hosts /etc/sarg/exclude_hosts
<span class="hljs-comment"># Formato da data</span>
date_format u
<span class="hljs-comment"># Último log</span>
lastlog <span class="hljs-number">0</span>
<span class="hljs-comment"># Remover arquivos temporários</span>
remove_temp_files yes
<span class="hljs-comment"># Indexar os relatórios</span>
index yes
<span class="hljs-comment"># Organização dos índices em árvore de arquivos</span>
index_tree file
<span class="hljs-comment"># Sobrescrever relatórios existentes</span>
overwrite_report yes
<span class="hljs-comment"># Registros sem identificação de usuário</span>
records_without_userid ip
<span class="hljs-comment"># Utilizar vírgula como separador</span>
use_comma yes
<span class="hljs-comment"># Utilitário de e-mail</span>
mail_utility mailx
<span class="hljs-comment"># Número de principais sites</span>
topsites_num <span class="hljs-number">100</span>
<span class="hljs-comment"># Ordem de classificação dos principais sites</span>
topsites_sort_order CONNECT D
<span class="hljs-comment"># Ordem de classificação do índice</span>
index_sort_order D
<span class="hljs-comment"># Códigos de exclusão</span>
exclude_codes /etc/sarg/exclude_codes
<span class="hljs-comment"># Tempo máximo de duração</span>
max_elapsed <span class="hljs-number">28800000</span>
<span class="hljs-comment"># Tipo de relatório</span>
report_<span class="hljs-built_in">type</span> topusers topsites sites_users users_sites date_time denied auth_failures site_user_time_date downloads
<span class="hljs-comment"># Arquivo de tabela de usuários</span>
usertab /etc/sarg/usertab
<span class="hljs-comment"># URLs longas</span>
long_url no
<span class="hljs-comment"># Data e hora por bytes</span>
date_time_by bytes
<span class="hljs-comment"># Conjunto de caracteres</span>
charset Latin1
<span class="hljs-comment"># Exibir mensagem de sucesso</span>
show_successful_message no
<span class="hljs-comment"># Exibir estatísticas de leitura</span>
show_<span class="hljs-built_in">read</span>_statistics no
<span class="hljs-comment"># Campos do relatório de principais usuários</span>
topuser_fields NUM DATE_TIME USERID CONNECT BYTES %BYTES IN-CACHE-OUT USED_TIME MILISEC %TIME TOTAL AVERAGE
<span class="hljs-comment"># Campos do relatório de usuários</span>
user_report_fields CONNECT BYTES %BYTES IN-CACHE-OUT USED_TIME MILISEC %TIME TOTAL AVERAGE
<span class="hljs-comment"># Número de principais usuários</span>
topuser_num <span class="hljs-number">0</span>
<span class="hljs-comment"># Exibir logotipo do SARG</span>
show_sarg_logo no
<span class="hljs-comment"># Arquivo CSS externo</span>
external_css_file http://<span class="hljs-number">192.168</span>.<span class="hljs-number">0.254</span>/squid-reports/style.css
<span class="hljs-comment"># Sufixo para download</span>
download_suffix <span class="hljs-string">"zip,arj,bzip,gz,ace,doc,iso,adt,bin,cab,com,dot,drv$,lha,lzh,mdb,mso,ppt,rtf,src,shs,sys,exe,dll,mp3,avi,mpg,mpeg"</span>
</code></pre>
        <h4 class="code-line" data-line-start="519" data-line-end="520">
            <a id="Arquivo_de_estilo_sarg_519"></a>Arquivo de estilo sarg
        </h4>
        <pre><code class="has-line-data" data-line-start="521" data-line-end="523" class="language-css">*<span class="hljs-rules">{<span class="hljs-rule"><span class="hljs-attribute">margin</span>:<span class="hljs-value"><span class="hljs-number">0</span></span></span>;<span class="hljs-rule"><span class="hljs-attribute">padding</span>:<span class="hljs-value"><span class="hljs-number">0</span></span></span>;<span class="hljs-rule"><span class="hljs-attribute">box-sizing</span>:<span class="hljs-value">border-box</span></span></span>}<span class="hljs-tag">html</span><span class="hljs-rules">{<span class="hljs-rule"><span class="hljs-attribute">background-color</span>:<span class="hljs-value"><span class="hljs-hexcolor">#f8f2ff</span></span></span>;<span class="hljs-rule"><span class="hljs-attribute">font-family</span>:<span class="hljs-value">Helvetica,Arial,sans-serif</span></span></span>}<span class="hljs-class">.logo</span><span class="hljs-rules">{<span class="hljs-rule"><span class="hljs-attribute">font-size</span>:<span class="hljs-value"><span class="hljs-number">0</span></span></span>;<span class="hljs-rule"><span class="hljs-attribute">color</span>:<span class="hljs-value"><span class="hljs-hexcolor">#966ccc</span></span></span>;<span class="hljs-rule"><span class="hljs-attribute">text-align</span>:<span class="hljs-value">center</span></span>;<span class="hljs-rule"><span class="hljs-attribute">vertical-align</span>:<span class="hljs-value">middle</span></span>;<span class="hljs-rule"><span class="hljs-attribute">border</span>:<span class="hljs-value">none</span></span>;<span class="hljs-rule"><span class="hljs-attribute">padding</span>:<span class="hljs-value"><span class="hljs-number">40px</span></span></span>;<span class="hljs-rule"><span class="hljs-attribute">margin-bottom</span>:<span class="hljs-value"><span class="hljs-number">5px</span></span></span></span>}<span class="hljs-class">.logo</span> <span class="hljs-tag">th</span><span class="hljs-rules">{<span class="hljs-rule"><span class="hljs-attribute">padding</span>:<span class="hljs-value"><span class="hljs-number">0</span></span></span></span>}<span class="hljs-class">.logo</span> <span class="hljs-tag">img</span><span class="hljs-rules">{<span class="hljs-rule"><span class="hljs-attribute">vertical-align</span>:<span class="hljs-value">middle</span></span>;<span class="hljs-rule"><span class="hljs-attribute">padding</span>:<span class="hljs-value"><span class="hljs-number">0</span></span></span>;<span class="hljs-rule"><span class="hljs-attribute">border</span>:<span class="hljs-value"><span class="hljs-number">0</span> none</span></span>;<span class="hljs-rule"><span class="hljs-attribute">width</span>:<span class="hljs-value"><span class="hljs-number">300px</span><span class="hljs-important">!important</span></span></span>;<span class="hljs-rule"><span class="hljs-attribute">height</span>:<span class="hljs-value"><span class="hljs-number">80px</span><span class="hljs-important">!important</span></span></span>;<span class="hljs-rule"><span class="hljs-attribute">filter</span>:<span class="hljs-value"><span class="hljs-function">hue-rotate</span>(<span class="hljs-number">35deg</span>)</span></span></span>}<span class="hljs-class">.body</span><span class="hljs-rules">{<span class="hljs-rule"><span class="hljs-attribute">font-size</span>:<span class="hljs-value"><span class="hljs-number">10px</span></span></span>;<span class="hljs-rule"><span class="hljs-attribute">color</span>:<span class="hljs-value"><span class="hljs-hexcolor">#000</span></span></span>;<span class="hljs-rule"><span class="hljs-attribute">background-color</span>:<span class="hljs-value"><span class="hljs-hexcolor">#ebebeb</span></span></span>;<span class="hljs-rule"><span class="hljs-attribute">background-image</span>:<span class="hljs-value"><span class="hljs-function">url</span>()</span></span></span>}<span class="hljs-class">.info</span><span class="hljs-rules">{<span class="hljs-rule"><span class="hljs-attribute">font-size</span>:<span class="hljs-value"><span class="hljs-number">10px</span></span></span>;<span class="hljs-rule"><span class="hljs-attribute">text-align</span>:<span class="hljs-value">center</span></span>;<span class="hljs-rule"><span class="hljs-attribute">margin-top</span>:<span class="hljs-value"><span class="hljs-number">1em</span></span></span>;<span class="hljs-rule"><span class="hljs-attribute">margin-bottom</span>:<span class="hljs-value"><span class="hljs-number">1em</span></span></span></span>}<span class="hljs-class">.info</span> <span class="hljs-tag">a</span><span class="hljs-pseudo">:link</span>,<span class="hljs-tag">a</span><span class="hljs-pseudo">:visited</span><span class="hljs-rules">{<span class="hljs-rule"><span class="hljs-attribute">color</span>:<span class="hljs-value"><span class="hljs-hexcolor">#e3e0e4</span></span></span>;<span class="hljs-rule"><span class="hljs-attribute">font-size</span>:<span class="hljs-value"><span class="hljs-number">10px</span></span></span>;<span class="hljs-rule"><span class="hljs-attribute">text-decoration</span>:<span class="hljs-value">none</span></span></span>}<span class="hljs-class">.title</span><span class="hljs-rules">{<span class="hljs-rule"><span class="hljs-attribute">width</span>:<span class="hljs-value"><span class="hljs-number">100%</span></span></span>;<span class="hljs-rule"><span class="hljs-attribute">text-align</span>:<span class="hljs-value">center</span></span>;<span class="hljs-rule"><span class="hljs-attribute">margin-bottom</span>:<span class="hljs-value"><span class="hljs-number">1em</span></span></span></span>}<span class="hljs-tag">div</span><span class="hljs-class">.title</span> &gt; <span class="hljs-tag">table</span><span class="hljs-rules">{<span class="hljs-rule"><span class="hljs-attribute">margin</span>:<span class="hljs-value">auto</span></span></span>}<span class="hljs-class">.title_c</span><span class="hljs-rules">{<span class="hljs-rule"><span class="hljs-attribute">font-size</span>:<span class="hljs-value"><span class="hljs-number">16px</span></span></span>;<span class="hljs-rule"><span class="hljs-attribute">color</span>:<span class="hljs-value"><span class="hljs-hexcolor">#45289d</span></span></span>;<span class="hljs-rule"><span class="hljs-attribute">background-color</span>:<span class="hljs-value"><span class="hljs-hexcolor">#f3f3f3</span></span></span>;<span class="hljs-rule"><span class="hljs-attribute">text-align</span>:<span class="hljs-value">center</span></span>;<span class="hljs-rule"><span class="hljs-attribute">padding-top</span>:<span class="hljs-value"><span class="hljs-number">20px</span></span></span>;<span class="hljs-rule"><span class="hljs-attribute">padding-bottom</span>:<span class="hljs-value"><span class="hljs-number">5px</span></span></span></span>}<span class="hljs-class">.title_l</span><span class="hljs-rules">{<span class="hljs-rule"><span class="hljs-attribute">font-size</span>:<span class="hljs-value"><span class="hljs-number">16px</span></span></span>;<span class="hljs-rule"><span class="hljs-attribute">color</span>:<span class="hljs-value"><span class="hljs-hexcolor">#966ccc</span></span></span>;<span class="hljs-rule"><span class="hljs-attribute">background-color</span>:<span class="hljs-value"><span class="hljs-hexcolor">#f3f3f3</span></span></span>;<span class="hljs-rule"><span class="hljs-attribute">text-align</span>:<span class="hljs-value">left</span></span>;<span class="hljs-rule"><span class="hljs-attribute">padding-top</span>:<span class="hljs-value"><span class="hljs-number">20px</span></span></span>;<span class="hljs-rule"><span class="hljs-attribute">padding-bottom</span>:<span class="hljs-value"><span class="hljs-number">5px</span></span></span></span>}<span class="hljs-class">.title_r</span><span class="hljs-rules">{<span class="hljs-rule"><span class="hljs-attribute">font-size</span>:<span class="hljs-value"><span class="hljs-number">16px</span></span></span>;<span class="hljs-rule"><span class="hljs-attribute">color</span>:<span class="hljs-value"><span class="hljs-hexcolor">#966ccc</span></span></span>;<span class="hljs-rule"><span class="hljs-attribute">background-color</span>:<span class="hljs-value"><span class="hljs-hexcolor">#f3f3f3</span></span></span>;<span class="hljs-rule"><span class="hljs-attribute">text-align</span>:<span class="hljs-value">right</span></span>;<span class="hljs-rule"><span class="hljs-attribute">padding-top</span>:<span class="hljs-value"><span class="hljs-number">20px</span></span></span>;<span class="hljs-rule"><span class="hljs-attribute">padding-bottom</span>:<span class="hljs-value"><span class="hljs-number">5px</span></span></span></span>}<span class="hljs-class">.index</span><span class="hljs-rules">{<span class="hljs-rule"><span class="hljs-attribute">width</span>:<span class="hljs-value"><span class="hljs-number">100%</span></span></span>;<span class="hljs-rule"><span class="hljs-attribute">text-align</span>:<span class="hljs-value">center</span></span></span>}<span class="hljs-tag">div</span><span class="hljs-class">.index</span> &gt; <span class="hljs-tag">table</span><span class="hljs-rules">{<span class="hljs-rule"><span class="hljs-attribute">margin</span>:<span class="hljs-value">auto</span></span></span>}<span class="hljs-class">.report</span><span class="hljs-rules">{<span class="hljs-rule"><span class="hljs-attribute">width</span>:<span class="hljs-value"><span class="hljs-number">100%</span></span></span>;<span class="hljs-rule"><span class="hljs-attribute">text-align</span>:<span class="hljs-value">center</span></span></span>}<span class="hljs-tag">div</span><span class="hljs-class">.report</span> &gt; <span class="hljs-tag">table</span><span class="hljs-rules">{<span class="hljs-rule"><span class="hljs-attribute">margin</span>:<span class="hljs-value">auto</span></span></span>}<span class="hljs-class">.header_l</span><span class="hljs-rules">{<span class="hljs-rule"><span class="hljs-attribute">font-size</span>:<span class="hljs-value"><span class="hljs-number">12px</span></span></span>;<span class="hljs-rule"><span class="hljs-attribute">color</span>:<span class="hljs-value"><span class="hljs-hexcolor">#3d3d3d</span></span></span>;<span class="hljs-rule"><span class="hljs-attribute">background-color</span>:<span class="hljs-value"><span class="hljs-hexcolor">#ddc7ff</span></span></span>;<span class="hljs-rule"><span class="hljs-attribute">text-align</span>:<span class="hljs-value">left</span></span>;<span class="hljs-rule"><span class="hljs-attribute">border-right</span>:<span class="hljs-value"><span class="hljs-number">2px</span> solid <span class="hljs-hexcolor">#66666632</span></span></span>;<span class="hljs-rule"><span class="hljs-attribute">border-bottom</span>:<span class="hljs-value"><span class="hljs-number">2px</span> solid <span class="hljs-hexcolor">#66666632</span></span></span>;<span class="hljs-rule"><span class="hljs-attribute">padding</span>:<span class="hljs-value"><span class="hljs-number">2px</span> <span class="hljs-number">8px</span></span></span></span>}<span class="hljs-class">.header_r</span><span class="hljs-rules">{<span class="hljs-rule"><span class="hljs-attribute">font-size</span>:<span class="hljs-value"><span class="hljs-number">12px</span></span></span>;<span class="hljs-rule"><span class="hljs-attribute">color</span>:<span class="hljs-value"><span class="hljs-hexcolor">#3d3d3d</span></span></span>;<span class="hljs-rule"><span class="hljs-attribute">background-color</span>:<span class="hljs-value"><span class="hljs-hexcolor">#ddc7ff</span></span></span>;<span class="hljs-rule"><span class="hljs-attribute">text-align</span>:<span class="hljs-value">right</span></span>;<span class="hljs-rule"><span class="hljs-attribute">border-right</span>:<span class="hljs-value"><span class="hljs-number">2px</span> solid <span class="hljs-hexcolor">#66666632</span></span></span>;<span class="hljs-rule"><span class="hljs-attribute">border-bottom</span>:<span class="hljs-value"><span class="hljs-number">2px</span> solid <span class="hljs-hexcolor">#66666632</span></span></span>;<span class="hljs-rule"><span class="hljs-attribute">padding</span>:<span class="hljs-value"><span class="hljs-number">2px</span> <span class="hljs-number">8px</span></span></span></span>}<span class="hljs-class">.header_c</span><span class="hljs-rules">{<span class="hljs-rule"><span class="hljs-attribute">font-size</span>:<span class="hljs-value"><span class="hljs-number">12px</span></span></span>;<span class="hljs-rule"><span class="hljs-attribute">color</span>:<span class="hljs-value"><span class="hljs-hexcolor">#3d3d3d</span></span></span>;<span class="hljs-rule"><span class="hljs-attribute">background-color</span>:<span class="hljs-value"><span class="hljs-hexcolor">#ddc7ff</span></span></span>;<span class="hljs-rule"><span class="hljs-attribute">text-align</span>:<span class="hljs-value">center</span></span>;<span class="hljs-rule"><span class="hljs-attribute">border-right</span>:<span class="hljs-value"><span class="hljs-number">2px</span> solid <span class="hljs-hexcolor">#66666632</span></span></span>;<span class="hljs-rule"><span class="hljs-attribute">border-bottom</span>:<span class="hljs-value"><span class="hljs-number">2px</span> solid <span class="hljs-hexcolor">#66666632</span></span></span>;<span class="hljs-rule"><span class="hljs-attribute">padding</span>:<span class="hljs-value"><span class="hljs-number">2px</span> <span class="hljs-number">8px</span></span></span></span>}<span class="hljs-class">.data</span><span class="hljs-rules">{<span class="hljs-rule"><span class="hljs-attribute">color</span>:<span class="hljs-value"><span class="hljs-hexcolor">#000</span></span></span>;<span class="hljs-rule"><span class="hljs-attribute">font-size</span>:<span class="hljs-value"><span class="hljs-number">12px</span></span></span>;<span class="hljs-rule"><span class="hljs-attribute">background-color</span>:<span class="hljs-value"><span class="hljs-hexcolor">#e6e6fa</span></span></span>;<span class="hljs-rule"><span class="hljs-attribute">text-align</span>:<span class="hljs-value">right</span></span>;<span class="hljs-rule"><span class="hljs-attribute">border-right</span>:<span class="hljs-value"><span class="hljs-number">2px</span> solid <span class="hljs-hexcolor">#695acd4a</span></span></span>;<span class="hljs-rule"><span class="hljs-attribute">border-bottom</span>:<span class="hljs-value"><span class="hljs-number">2px</span> solid <span class="hljs-hexcolor">#695acd4a</span></span></span>;<span class="hljs-rule"><span class="hljs-attribute">padding</span>:<span class="hljs-value"><span class="hljs-number">2px</span> <span class="hljs-number">8px</span></span></span></span>}<span class="hljs-class">.data</span> <span class="hljs-tag">a</span><span class="hljs-pseudo">:link</span>,<span class="hljs-tag">a</span><span class="hljs-pseudo">:visited</span><span class="hljs-rules">{<span class="hljs-rule"><span class="hljs-attribute">color</span>:<span class="hljs-value"><span class="hljs-hexcolor">#732dff</span></span></span>;<span class="hljs-rule"><span class="hljs-attribute">font-size</span>:<span class="hljs-value"><span class="hljs-number">12px</span></span></span>;<span class="hljs-rule"><span class="hljs-attribute">background-color</span>:<span class="hljs-value"><span class="hljs-hexcolor">#e6e6fa</span></span></span>;<span class="hljs-rule"><span class="hljs-attribute">text-align</span>:<span class="hljs-value">right</span></span>;<span class="hljs-rule"><span class="hljs-attribute">text-decoration</span>:<span class="hljs-value">none</span></span>;<span class="hljs-rule"><span class="hljs-attribute">padding</span>:<span class="hljs-value"><span class="hljs-number">2px</span> <span class="hljs-number">8px</span></span></span></span>}<span class="hljs-class">.data2</span><span class="hljs-rules">{<span class="hljs-rule"><span class="hljs-attribute">color</span>:<span class="hljs-value"><span class="hljs-hexcolor">#000</span></span></span>;<span class="hljs-rule"><span class="hljs-attribute">font-size</span>:<span class="hljs-value"><span class="hljs-number">12px</span></span></span>;<span class="hljs-rule"><span class="hljs-attribute">background-color</span>:<span class="hljs-value"><span class="hljs-hexcolor">#e6e6fa</span></span></span>;<span class="hljs-rule"><span class="hljs-attribute">text-align</span>:<span class="hljs-value">left</span></span>;<span class="hljs-rule"><span class="hljs-attribute">border-right</span>:<span class="hljs-value"><span class="hljs-number">2px</span> solid <span class="hljs-hexcolor">#695acd4a</span></span></span>;<span class="hljs-rule"><span class="hljs-attribute">border-bottom</span>:<span class="hljs-value"><span class="hljs-number">2px</span> solid <span class="hljs-hexcolor">#695acd4a</span></span></span>;<span class="hljs-rule"><span class="hljs-attribute">padding</span>:<span class="hljs-value"><span class="hljs-number">2px</span> <span class="hljs-number">8px</span></span></span></span>}<span class="hljs-class">.data2</span> <span class="hljs-tag">a</span><span class="hljs-pseudo">:link</span>,<span class="hljs-tag">a</span><span class="hljs-pseudo">:visited</span><span class="hljs-rules">{<span class="hljs-rule"><span class="hljs-attribute">color</span>:<span class="hljs-value"><span class="hljs-hexcolor">#732dff</span></span></span>;<span class="hljs-rule"><span class="hljs-attribute">font-size</span>:<span class="hljs-value"><span class="hljs-number">12px</span></span></span>;<span class="hljs-rule"><span class="hljs-attribute">text-align</span>:<span class="hljs-value">left</span></span>;<span class="hljs-rule"><span class="hljs-attribute">background-color</span>:<span class="hljs-value"><span class="hljs-hexcolor">#e6e6fa</span></span></span>;<span class="hljs-rule"><span class="hljs-attribute">text-decoration</span>:<span class="hljs-value">none</span></span></span>}<span class="hljs-class">.data3</span><span class="hljs-rules">{<span class="hljs-rule"><span class="hljs-attribute">color</span>:<span class="hljs-value"><span class="hljs-hexcolor">#000</span></span></span>;<span class="hljs-rule"><span class="hljs-attribute">font-size</span>:<span class="hljs-value"><span class="hljs-number">12px</span></span></span>;<span class="hljs-rule"><span class="hljs-attribute">background-color</span>:<span class="hljs-value"><span class="hljs-hexcolor">#e6e6fa</span></span></span>;<span class="hljs-rule"><span class="hljs-attribute">text-align</span>:<span class="hljs-value">center</span></span>;<span class="hljs-rule"><span class="hljs-attribute">border-right</span>:<span class="hljs-value"><span class="hljs-number">1px</span> solid <span class="hljs-hexcolor">#6139f0</span></span></span>;<span class="hljs-rule"><span class="hljs-attribute">border-bottom</span>:<span class="hljs-value"><span class="hljs-number">1px</span> solid <span class="hljs-hexcolor">#6139f0</span></span></span>;<span class="hljs-rule"><span class="hljs-attribute">padding</span>:<span class="hljs-value"><span class="hljs-number">22px</span></span></span></span>}<span class="hljs-class">.data3</span> <span class="hljs-tag">a</span><span class="hljs-pseudo">:link</span>,<span class="hljs-tag">a</span><span class="hljs-pseudo">:visited</span><span class="hljs-rules">{<span class="hljs-rule"><span class="hljs-attribute">color</span>:<span class="hljs-value"><span class="hljs-hexcolor">#732dff</span></span></span>;<span class="hljs-rule"><span class="hljs-attribute">font-size</span>:<span class="hljs-value"><span class="hljs-number">12px</span></span></span>;<span class="hljs-rule"><span class="hljs-attribute">text-align</span>:<span class="hljs-value">center</span></span>;<span class="hljs-rule"><span class="hljs-attribute">background-color</span>:<span class="hljs-value"><span class="hljs-hexcolor">#e6e6fa</span></span></span>;<span class="hljs-rule"><span class="hljs-attribute">text-decoration</span>:<span class="hljs-value">none</span></span></span>}<span class="hljs-class">.text</span><span class="hljs-rules">{<span class="hljs-rule"><span class="hljs-attribute">color</span>:<span class="hljs-value"><span class="hljs-hexcolor">#000</span></span></span>;<span class="hljs-rule"><span class="hljs-attribute">font-size</span>:<span class="hljs-value"><span class="hljs-number">12px</span></span></span>;<span class="hljs-rule"><span class="hljs-attribute">background-color</span>:<span class="hljs-value"><span class="hljs-hexcolor">#e6e6fa</span></span></span>;<span class="hljs-rule"><span class="hljs-attribute">text-align</span>:<span class="hljs-value">right</span></span></span>}<span class="hljs-class">.more</span><span class="hljs-rules">{<span class="hljs-rule"><span class="hljs-attribute">font-style</span>:<span class="hljs-value">italic</span></span>;<span class="hljs-rule"><span class="hljs-attribute">color</span>:<span class="hljs-value"><span class="hljs-hexcolor">#777</span></span></span></span>}<span class="hljs-class">.link</span><span class="hljs-rules">{<span class="hljs-rule"><span class="hljs-attribute">font-size</span>:<span class="hljs-value"><span class="hljs-number">12px</span></span></span>;<span class="hljs-rule"><span class="hljs-attribute">color</span>:<span class="hljs-value"><span class="hljs-hexcolor">#732dff</span></span></span></span>}<span class="hljs-class">.link</span> <span class="hljs-tag">a</span><span class="hljs-pseudo">:link</span>,<span class="hljs-tag">a</span><span class="hljs-pseudo">:visited</span><span class="hljs-rules">{<span class="hljs-rule"><span class="hljs-attribute">font-size</span>:<span class="hljs-value"><span class="hljs-number">12px</span></span></span>;<span class="hljs-rule"><span class="hljs-attribute">color</span>:<span class="hljs-value"><span class="hljs-hexcolor">#6139f0</span></span></span>;<span class="hljs-rule"><span class="hljs-attribute">text-decoration</span>:<span class="hljs-value">none</span></span></span>}<span class="hljs-tag">a</span> &gt; <span class="hljs-tag">img</span><span class="hljs-rules">{<span class="hljs-rule"><span class="hljs-attribute">border</span>:<span class="hljs-value">none</span></span></span>}<span class="hljs-class">.warn</span><span class="hljs-rules">{<span class="hljs-rule"><span class="hljs-attribute">margin</span>:<span class="hljs-value">.<span class="hljs-number">5em</span></span></span></span>}<span class="hljs-class">.warn</span> &gt; <span class="hljs-tag">span</span><span class="hljs-rules">{<span class="hljs-rule"><span class="hljs-attribute">padding</span>:<span class="hljs-value">.<span class="hljs-number">5em</span></span></span>;<span class="hljs-rule"><span class="hljs-attribute">border</span>:<span class="hljs-value"><span class="hljs-number">2px</span> solid <span class="hljs-hexcolor">#000</span></span></span>;<span class="hljs-rule"><span class="hljs-attribute">background-color</span>:<span class="hljs-value">orange</span></span>;<span class="hljs-rule"><span class="hljs-attribute">font-size</span>:<span class="hljs-value"><span class="hljs-number">14px</span></span></span></span>}
</code></pre>
        <br /><br />
        <h2 class="code-line" data-line-start="525" data-line-end="526">
            <a id="DHCP_525"></a>DHCP
        </h2>
        <h3 class="code-line" data-line-start="527" data-line-end="528">
            <a id="Instalar_o_iscdhcpserver_527"></a>Instalar o isc-dhcp-server
        </h3>
        <pre><code class="has-line-data" data-line-start="529" data-line-end="531" class="language-bash">sudo apt install isc-dhcp-server
</code></pre>
        <br />
        <h3 class="code-line" data-line-start="534" data-line-end="535">
            <a id="Configurar_o_arquivo_etcdhcpdhcpdconf_534"></a>Configurar o
            arquivo /etc/dhcp/dhcpd.conf
        </h3>
        <p class="has-line-data" data-line-start="535" data-line-end="536">
            conteúdo do arquivo [adicionar ao fim do arquivo]:
        </p>
        <pre><code class="has-line-data" data-line-start="537" data-line-end="550" class="language-toml"># Configuração do serviço DHCP.
authoritative;
subnet 192.168.0.0 netmask 255.255.255.0 {
        range 192.168.0.10 192.168.0.200;
        option domain-name-servers 192.168.0.254, 8.8.8.8, 1.1.1.1;
        option domain-name "srv-dhcp.conectanet.lan";
        option subnet-mask 255.255.255.0;
        option routers 192.168.0.254;
        option broadcast-address 192.168.0.255;
        default-lease-time 600;
        max-lease-time 7200;
        }
</code></pre>
        <h4 class="code-line" data-line-start="551" data-line-end="552">
            <a id="Configurar_interface_para_execuo_do_DHCP_551"></a>Configurar
            interface para execução do DHCP
        </h4>
        <pre><code class="has-line-data" data-line-start="553" data-line-end="555" class="language-bash">sudo vi /etc/default/isc-dhcp-server
</code></pre>
        <p class="has-line-data" data-line-start="555" data-line-end="556">
            conteúdo do arquivo:
        </p>
        <pre><code class="has-line-data" data-line-start="557" data-line-end="559" class="language-toml"><span class="hljs-setting">INTERFACES=<span class="hljs-value"><span class="hljs-string">"enp2s0"</span></span></span>
</code></pre>
        <h4 class="code-line" data-line-start="560" data-line-end="561">
            <a id="Reiniciar_o_servio_iscdhcpserver_560"></a>Reiniciar o serviço
            isc-dhcp-server
        </h4>
        <pre><code class="has-line-data" data-line-start="562" data-line-end="564" class="language-bash">sudo service isc-dhcp-server restart
</code></pre>
        <br /><br />
        <h2 class="code-line" data-line-start="567" data-line-end="568">
            <a id="Active_Directory_sambaaddc_567"></a>Active Directory
            (samba-ad-dc)
        </h2>
        <h3 class="code-line" data-line-start="569" data-line-end="570">
            <a id="Instalar_as_dependncias_569"></a>Instalar as dependências
        </h3>
        <br />
        <pre><code class="has-line-data" data-line-start="574" data-line-end="576" class="language-bash">sudo apt install build-essential libacl1-dev libattr1-dev libblkid-dev libgnutls-dev libreadline-dev python-dev libpam0g-dev python-dnspython gdb pkg-config libpopt-dev libldap2-dev dnsutils libbsd-dev docbook-xsl libcups2-dev nfs-kernel-server samba samba-common smbclient cifs-utils samba-vfs-modules samba-testsuite samba-dbg acl attr samba-dsdb-modules cups cups-common cups-core-drivers nmap winbind smbclient libnss-winbind libpam-winbind python3 krb5-user krb5-config -y
</code></pre>
        <h4 class="code-line" data-line-start="577" data-line-end="578">
            <a id="Campos_de_configurao_do_KERBEROS_577"></a>Campos de
            configuração do KERBEROS
        </h4>
        <pre><code class="has-line-data" data-line-start="579" data-line-end="586" class="language-bash"><span class="hljs-comment"># Realm</span>
CONECTANET.LAN
<span class="hljs-comment"># Servers</span>
srv-cnet.conectanet.lan
<span class="hljs-comment"># ADM Server</span>
srv-cnet.conectanet.lan
</code></pre>
        <br />
        <h3 class="code-line" data-line-start="589" data-line-end="590">
            <a id="Desabilitar_servios_e_ativar_o_sambaaddc_589"></a>Desabilitar
            serviços e ativar o <code>samba-ad-dc</code>
        </h3>
        <pre><code class="has-line-data" data-line-start="591" data-line-end="596" class="language-bash">sudo systemctl <span class="hljs-built_in">disable</span> --now nmbd smbd winbind

sudo systemctl unmask samba-ad-dc
sudo systemctl <span class="hljs-built_in">enable</span> samba-ad-dc
</code></pre>
        <br />
        <h3 class="code-line" data-line-start="599" data-line-end="600">
            <a id="Renomeando_o_arquivo_smbconf_599"></a>Renomeando o arquivo
            <code>smb.conf</code>
        </h3>
        <pre><code class="has-line-data" data-line-start="601" data-line-end="603" class="language-bash">sudo mv /etc/samba/smb.conf /etc/samba/smb.conf.bak
</code></pre>
        <br />
        <h3 class="code-line" data-line-start="606" data-line-end="607">
            <a id="Provisionando_o_domnio_606"></a>Provisionando o domínio
        </h3>
        <pre><code class="has-line-data" data-line-start="608" data-line-end="623" class="language-bash">sudo samba-tool domain provision --use-rfc2307 --use-xattr=yes --interactive

<span class="hljs-comment"># Campo REALM</span>
    conectanet.lan
<span class="hljs-comment"># Campo DOMAIN</span>
    conectanet
<span class="hljs-comment"># Campo SERVER ROLE</span>
    dc
<span class="hljs-comment"># Campo DNS BACKEND</span>
    SAMBA_INTERNAL
<span class="hljs-comment"># Campo DNS FORWARDER</span>
    <span class="hljs-number">8.8</span>.<span class="hljs-number">8.8</span>
<span class="hljs-comment"># Campo ADMINISTRATOR PASSWORD</span>
    AdmCnet@<span class="hljs-number">2023.2</span>
</code></pre>
        <br />
        <h3 class="code-line" data-line-start="626" data-line-end="627">
            <a id="Iniciar_o_sambaaddc_e_reiniciar_o_servidor_626"></a>Iniciar o
            <code>samba-ad-dc</code> e reiniciar o servidor
        </h3>
        <pre><code class="has-line-data" data-line-start="628" data-line-end="631" class="language-bash">sudo systemctl start samba-ad-dc
reboot
</code></pre>
        <script
            data-cfasync="false"
            src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"
        ></script>
    </body>
</html>
