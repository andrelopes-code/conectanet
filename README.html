<!DOCTYPE html>
<html>
<head>
<title>README.md</title>
<meta http-equiv="Content-type" content="text/html;charset=UTF-8">

<style>
/* https://github.com/microsoft/vscode/blob/master/extensions/markdown-language-features/media/markdown.css */
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/

body {
	font-family: var(--vscode-markdown-font-family, -apple-system, BlinkMacSystemFont, "Segoe WPC", "Segoe UI", "Ubuntu", "Droid Sans", sans-serif);
	font-size: var(--vscode-markdown-font-size, 14px);
	padding: 0 26px;
	line-height: var(--vscode-markdown-line-height, 22px);
	word-wrap: break-word;
}

#code-csp-warning {
	position: fixed;
	top: 0;
	right: 0;
	color: white;
	margin: 16px;
	text-align: center;
	font-size: 12px;
	font-family: sans-serif;
	background-color:#444444;
	cursor: pointer;
	padding: 6px;
	box-shadow: 1px 1px 1px rgba(0,0,0,.25);
}

#code-csp-warning:hover {
	text-decoration: none;
	background-color:#007acc;
	box-shadow: 2px 2px 2px rgba(0,0,0,.25);
}

body.scrollBeyondLastLine {
	margin-bottom: calc(100vh - 22px);
}

body.showEditorSelection .code-line {
	position: relative;
}

body.showEditorSelection .code-active-line:before,
body.showEditorSelection .code-line:hover:before {
	content: "";
	display: block;
	position: absolute;
	top: 0;
	left: -12px;
	height: 100%;
}

body.showEditorSelection li.code-active-line:before,
body.showEditorSelection li.code-line:hover:before {
	left: -30px;
}

.vscode-light.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(0, 0, 0, 0.15);
}

.vscode-light.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(0, 0, 0, 0.40);
}

.vscode-light.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

.vscode-dark.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(255, 255, 255, 0.4);
}

.vscode-dark.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(255, 255, 255, 0.60);
}

.vscode-dark.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

.vscode-high-contrast.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(255, 160, 0, 0.7);
}

.vscode-high-contrast.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(255, 160, 0, 1);
}

.vscode-high-contrast.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

img {
	max-width: 100%;
	max-height: 100%;
}

a {
	text-decoration: none;
}

a:hover {
	text-decoration: underline;
}

a:focus,
input:focus,
select:focus,
textarea:focus {
	outline: 1px solid -webkit-focus-ring-color;
	outline-offset: -1px;
}

hr {
	border: 0;
	height: 2px;
	border-bottom: 2px solid;
}

h1 {
	padding-bottom: 0.3em;
	line-height: 1.2;
	border-bottom-width: 1px;
	border-bottom-style: solid;
}

h1, h2, h3 {
	font-weight: normal;
}

table {
	border-collapse: collapse;
}

table > thead > tr > th {
	text-align: left;
	border-bottom: 1px solid;
}

table > thead > tr > th,
table > thead > tr > td,
table > tbody > tr > th,
table > tbody > tr > td {
	padding: 5px 10px;
}

table > tbody > tr + tr > td {
	border-top: 1px solid;
}

blockquote {
	margin: 0 7px 0 5px;
	padding: 0 16px 0 10px;
	border-left-width: 5px;
	border-left-style: solid;
}

code {
	font-family: Menlo, Monaco, Consolas, "Droid Sans Mono", "Courier New", monospace, "Droid Sans Fallback";
	font-size: 1em;
	line-height: 1.357em;
}

body.wordWrap pre {
	white-space: pre-wrap;
}

pre:not(.hljs),
pre.hljs code > div {
	padding: 16px;
	border-radius: 3px;
	overflow: auto;
}

pre code {
	color: var(--vscode-editor-foreground);
	tab-size: 4;
}

/** Theming */

.vscode-light pre {
	background-color: rgba(220, 220, 220, 0.4);
}

.vscode-dark pre {
	background-color: rgba(10, 10, 10, 0.4);
}

.vscode-high-contrast pre {
	background-color: rgb(0, 0, 0);
}

.vscode-high-contrast h1 {
	border-color: rgb(0, 0, 0);
}

.vscode-light table > thead > tr > th {
	border-color: rgba(0, 0, 0, 0.69);
}

.vscode-dark table > thead > tr > th {
	border-color: rgba(255, 255, 255, 0.69);
}

.vscode-light h1,
.vscode-light hr,
.vscode-light table > tbody > tr + tr > td {
	border-color: rgba(0, 0, 0, 0.18);
}

.vscode-dark h1,
.vscode-dark hr,
.vscode-dark table > tbody > tr + tr > td {
	border-color: rgba(255, 255, 255, 0.18);
}

</style>

<style>
/* Tomorrow Theme */
/* http://jmblog.github.com/color-themes-for-google-code-highlightjs */
/* Original theme - https://github.com/chriskempson/tomorrow-theme */

/* Tomorrow Comment */
.hljs-comment,
.hljs-quote {
	color: #8e908c;
}

/* Tomorrow Red */
.hljs-variable,
.hljs-template-variable,
.hljs-tag,
.hljs-name,
.hljs-selector-id,
.hljs-selector-class,
.hljs-regexp,
.hljs-deletion {
	color: #c82829;
}

/* Tomorrow Orange */
.hljs-number,
.hljs-built_in,
.hljs-builtin-name,
.hljs-literal,
.hljs-type,
.hljs-params,
.hljs-meta,
.hljs-link {
	color: #f5871f;
}

/* Tomorrow Yellow */
.hljs-attribute {
	color: #eab700;
}

/* Tomorrow Green */
.hljs-string,
.hljs-symbol,
.hljs-bullet,
.hljs-addition {
	color: #718c00;
}

/* Tomorrow Blue */
.hljs-title,
.hljs-section {
	color: #4271ae;
}

/* Tomorrow Purple */
.hljs-keyword,
.hljs-selector-tag {
	color: #8959a8;
}

.hljs {
	display: block;
	overflow-x: auto;
	color: #4d4d4c;
	padding: 0.5em;
}

.hljs-emphasis {
	font-style: italic;
}

.hljs-strong {
	font-weight: bold;
}
</style>

<style>
/*
 * Markdown PDF CSS
 */

 body {
	font-family: -apple-system, BlinkMacSystemFont, "Segoe WPC", "Segoe UI", "Ubuntu", "Droid Sans", sans-serif, "Meiryo";
	padding: 0 12px;
}

pre {
	background-color: #f8f8f8;
	border: 1px solid #cccccc;
	border-radius: 3px;
	overflow-x: auto;
	white-space: pre-wrap;
	overflow-wrap: break-word;
}

pre:not(.hljs) {
	padding: 23px;
	line-height: 19px;
}

blockquote {
	background: rgba(127, 127, 127, 0.1);
	border-color: rgba(0, 122, 204, 0.5);
}

.emoji {
	height: 1.4em;
}

code {
	font-size: 14px;
	line-height: 19px;
}

/* for inline code */
:not(pre):not(.hljs) > code {
	color: #C9AE75; /* Change the old color so it seems less like an error */
	font-size: inherit;
}

/* Page Break : use <div class="page"/> to insert page break
-------------------------------------------------------- */
.page {
	page-break-after: always;
}

</style>

<script src="https://unpkg.com/mermaid/dist/mermaid.min.js"></script>
</head>
<body>
  <script>
    mermaid.initialize({
      startOnLoad: true,
      theme: document.body.classList.contains('vscode-dark') || document.body.classList.contains('vscode-high-contrast')
          ? 'dark'
          : 'default'
    });
  </script>
<h1 id="conectanet">ConectaNet</h1>
<br>
<br>
<h2 id="configura%C3%A7%C3%A3o-b%C3%A1sica">Configuração Básica</h2>
<h3 id="informa%C3%A7%C3%B5es-da-m%C3%A1quina">Informações da Máquina</h3>
<ul>
<li>Nome da máquina: <strong>srv-conectanet</strong></li>
<li>sistema operacional: <strong>ubuntu server 16.04 LTS</strong></li>
<li>Nome de usuário: <strong>conectanet</strong></li>
<li>Senha: <strong>ConectaNet@2023.2</strong></li>
<li>domínio: <strong>conecta.net</strong></li>
</ul>
<br>
<h3 id="atualiza%C3%A7%C3%A3o-dos-pacotes-do-sistema">Atualização dos Pacotes do Sistema</h3>
<p>Para garantir que o sistema esteja atualizado, execute os seguintes comandos:</p>
<pre class="hljs"><code><div>sudo apt update
sudo apt upgrade -y
</div></code></pre>
<br>
<h3 id="configura%C3%A7%C3%A3o-do-arquivo-etchosts">Configuração do Arquivo <code>/etc/hosts</code></h3>
<p>Edite o arquivo <code>/etc/hosts</code> com o seguinte conteúdo:</p>
<pre class="hljs"><code><div>sudo vi /etc/hosts
</div></code></pre>
<p>conteúdo do arquivo:</p>
<pre class="hljs"><code><div>127.0.0.1       localhost
127.0.1.1       srv-conectanet
192.168.15.254  srv-conectanet.conecta.net      srv-conectanet

<span class="hljs-comment"># The following lines are desirable for IPv6 capable hosts</span>
::1     localhost ip6-localhost ip6-loopback
ff02::1 ip6-allnodes
ff02::2 ip6-allrouters
</div></code></pre>
<br>
<h3 id="configura%C3%A7%C3%A3o-das-interfaces-de-rede">Configuração das Interfaces de Rede</h3>
<p>Edite o arquivo <code>/etc/network/interfaces</code> com o seguinte conteúdo:</p>
<pre class="hljs"><code><div>sudo vi /etc/network/interfaces
</div></code></pre>
<p>conteúdo do arquivo:</p>
<pre class="hljs"><code><div><span class="hljs-comment"># This file describes the network interfaces available on your system</span>
<span class="hljs-comment"># and how to activate them. For more information, see interfaces(5).</span>

<span class="hljs-built_in">source</span> /etc/network/interfaces.d/*

<span class="hljs-comment"># The loopback network interface</span>
auto lo
iface lo inet loopback

<span class="hljs-comment"># Interface de rede primária</span>
auto eno1
iface eno1 inet dhcp

<span class="hljs-comment"># Interface de rede secundária</span>
auto enp2s0
iface enp2s0 inet static

address 192.168.15.254
netmask 255.255.255.0
network 192.168.15.0
broadcast 192.168.15.255
dns-nameserver 192.168.15.254 192.168.3.254 8.8.8.8 1.1.1.1
dns-domain conecta.net
dns-search conecta.net
</div></code></pre>
<br>
<br>
<h2 id="firewall-iptables">Firewall Iptables</h2>
<h3 id="arquivo-de-script-das-regras-do-firewall-iptables">Arquivo de Script das Regras do Firewall (Iptables)</h3>
<p>conteúdo do arquivo <code>firewall</code>:</p>
<pre class="hljs"><code><div><span class="hljs-meta">#!/bin/bash

</span>
<span class="hljs-comment"># Variaveis locais</span>
ifaceEx=<span class="hljs-string">"enp0s3"</span>            <span class="hljs-comment"># Interface de rede externa</span>
ifaceIn=<span class="hljs-string">"enp0s8"</span>            <span class="hljs-comment"># Interface de rede interna</span>
localnet=<span class="hljs-string">"192.168.15.0/24"</span>  <span class="hljs-comment"># endereço da rede local                  </span>

<span class="hljs-comment">#==  Funcoes para definicao de regras =============================================================#</span>

<span class="hljs-function"><span class="hljs-title">local</span></span>()
{
    <span class="hljs-comment"># Funcao para configuracao das regras de firewall para comunicacao local</span>

    <span class="hljs-comment"># Libera a comunicacao (I/O) do servidor com a rede local e com a internet</span>
    <span class="hljs-comment"># Permite trafego TCP e UDP de entrada e saida nas portas</span>
    <span class="hljs-comment"># 80, 443, 53, 123 (HTTP, HTTPS, DNS, NTP)</span>
    iptables -t filter -A INPUT -i <span class="hljs-variable">$ifaceEx</span> -p tcp -m multiport --sports 80,443 -j ACCEPT
    iptables -t filter -A INPUT -i <span class="hljs-variable">$ifaceEx</span> -p udp -m multiport --sports 53,123 -j ACCEPT
    iptables -t filter -A OUTPUT -o <span class="hljs-variable">$ifaceEx</span> -p tcp -m multiport --dports 80,443 -j ACCEPT
    iptables -t filter -A OUTPUT -o <span class="hljs-variable">$ifaceEx</span> -p udp -m multiport --dports 53,123 -j ACCEPT

    <span class="hljs-comment"># Libera todo o trafego da lo na rede</span>
    iptables -t filter -A INPUT -i lo -j ACCEPT
    iptables -t filter -A OUTPUT -o lo -j ACCEPT

    <span class="hljs-comment"># Libera o ping (ICMP) no localhost</span>
    iptables -t filter -A INPUT -i <span class="hljs-variable">$ifaceEx</span> -p icmp --icmp-type 0 -j ACCEPT
    iptables -t filter -A INPUT -i <span class="hljs-variable">$ifaceIn</span> -p icmp --icmp-type 0 -j ACCEPT
    iptables -t filter -A OUTPUT -o <span class="hljs-variable">$ifaceEx</span> -p icmp --icmp-type 8 -j ACCEPT
    iptables -t filter -A OUTPUT -o <span class="hljs-variable">$ifaceIn</span> -p icmp --icmp-type 8 -j ACCEPT

    <span class="hljs-comment"># Libera o trafego TCP do Squid (3128)</span>
    iptables -t filter -A INPUT -i <span class="hljs-variable">$ifaceIn</span> -p tcp --dport 3128 -j ACCEPT
    iptables -t filter -A OUTPUT -o <span class="hljs-variable">$ifaceIn</span> -p tcp --sport 3128 -j ACCEPT

    <span class="hljs-comment"># Libera trafego nas portas do Samba (139 e 445)</span>
    iptables -t filter -A INPUT -p tcp -m multiport --dports 139,445 -j ACCEPT
    iptables -t filter -A OUTPUT -p tcp -m multiport --sports 139,445 -j ACCEPT
    
    <span class="hljs-comment"># SSH</span>
    iptables -t filter -A INPUT -p tcp --dport 22 -j ACCEPT
    iptables -t filter -A OUTPUT -p tcp --sport 22 -j ACCEPT
}

<span class="hljs-function"><span class="hljs-title">forward</span></span>()
{
    <span class="hljs-comment"># Funcao para encaminhamento de trafego entre WAN e LAN</span>

    <span class="hljs-comment"># Libera o trafego entre a INTERNET e a REDE LOCAL</span>
    iptables -t filter -A FORWARD -i <span class="hljs-variable">$ifaceEx</span> -p tcp -m multiport --sports 80,443 -d <span class="hljs-variable">$localnet</span> -j ACCEPT
    iptables -t filter -A FORWARD -i <span class="hljs-variable">$ifaceEx</span> -p udp -m multiport --sports 53,123 -d <span class="hljs-variable">$localnet</span> -j ACCEPT
    iptables -t filter -A FORWARD -i <span class="hljs-variable">$ifaceIn</span> -p tcp -m multiport --dports 80,443 -s <span class="hljs-variable">$localnet</span> -j ACCEPT
    iptables -t filter -A FORWARD -i <span class="hljs-variable">$ifaceIn</span> -p udp -m multiport --dports 53,123 -s <span class="hljs-variable">$localnet</span> -j ACCEPT

    <span class="hljs-comment"># Libera o ping entre a INTERNET e a REDE LOCAL</span>
    iptables -t filter -A FORWARD -i <span class="hljs-variable">$ifaceIn</span> -p icmp --icmp-type 8 -s <span class="hljs-variable">$localnet</span> -j ACCEPT
    iptables -t filter -A FORWARD -o <span class="hljs-variable">$ifaceIn</span> -p icmp --icmp-type 0 -d <span class="hljs-variable">$localnet</span> -j ACCEPT
    iptables -t filter -A FORWARD -i <span class="hljs-variable">$ifaceEx</span> -p icmp --icmp-type 0 -d <span class="hljs-variable">$localnet</span> -j ACCEPT
    iptables -t filter -A FORWARD -o <span class="hljs-variable">$ifaceEx</span> -p icmp --icmp-type 8 -s <span class="hljs-variable">$localnet</span> -j ACCEPT
}

<span class="hljs-function"><span class="hljs-title">internet</span></span>()
{ 
    <span class="hljs-comment"># Funcao para habilitar o compartilhamento da internet entre as redes</span>

    <span class="hljs-comment"># Habilita o encaminhamento de IP</span>
    sysctl -w net.ipv4.ip_forward=1

    <span class="hljs-comment"># Configura NAT para o trafego da LAN para a Internet</span>
    iptables -t nat -A POSTROUTING -s <span class="hljs-variable">$localnet</span> -o <span class="hljs-variable">$ifaceEx</span> -j MASQUERADE
    
    <span class="hljs-comment"># Direcionar navegacao na porta HTTP (80) para a porta do proxy/squid (3128)</span>
    iptables -t nat -A PREROUTING -i <span class="hljs-variable">$ifaceIn</span> -p tcp --dport 80 -j REDIRECT --to-port 3128
}

<span class="hljs-function"><span class="hljs-title">default</span></span>()
{
    <span class="hljs-comment"># Funcao para definir as regras padrao</span>

    <span class="hljs-comment"># Bloqueia tudo que não foi explicitamente liberado</span>
    iptables -t filter -P INPUT DROP
    iptables -t filter -P OUTPUT DROP
    iptables -t filter -P FORWARD DROP
}

<span class="hljs-comment">#==  Funcoes de controle  =========================================================================#</span>

<span class="hljs-function"><span class="hljs-title">iniciar</span></span>()
{
    <span class="hljs-comment"># Funcao para iniciar o firewall</span>

    <span class="hljs-built_in">local</span>
    forward
    default
    internet
}

<span class="hljs-function"><span class="hljs-title">parar</span></span>()
{
    <span class="hljs-comment"># Funcao para parar o firewall</span>

    iptables -t filter -P INPUT ACCEPT
    iptables -t filter -P OUTPUT ACCEPT
    iptables -t filter -P FORWARD ACCEPT
    iptables -t filter -F
}

<span class="hljs-comment">#==  Script para controle do firewall  ============================================================#</span>

<span class="hljs-keyword">case</span> <span class="hljs-variable">$1</span> <span class="hljs-keyword">in</span>
start|Start|START)iniciar;;
stop|Stop|STOP)parar;;
restart|Restart|RESTART)parar;iniciar;;
listar|list)iptables -t filter -nvL;;
vi|conf)sudo vi /usr/<span class="hljs-built_in">local</span>/sbin/firewall;;
*)<span class="hljs-built_in">echo</span> <span class="hljs-string">"usage: 
firewall [start|stop|restart|list|vi]"</span>;;
<span class="hljs-keyword">esac</span>

&lt;br&gt;

</div></code></pre>
<h4 id="tornar-o-script-um-executavel">Tornar o script um executavel</h4>
<pre class="hljs"><code><div>sudo chmod +x firewall
</div></code></pre>
<br>
<h4 id="mover-o-script-para-uma-pasta-do-path">Mover o script para uma pasta do $PATH</h4>
<pre class="hljs"><code><div>sudo mv firewall /usr/<span class="hljs-built_in">local</span>/sbin
</div></code></pre>
<br>
<h3 id="inicializa%C3%A7%C3%A3o-autom%C3%A1tica-do-script-firewall">Inicialização Automática do Script Firewall</h3>
<br>
<h4 id="criar-o-arquivo-de-servi%C3%A7o-do-firewall">Criar o arquivo de serviço do firewall</h4>
<pre class="hljs"><code><div>sudo vi /lib/systemd/system/firewall.service
</div></code></pre>
<p>conteúdo do arquivo:</p>
<pre class="hljs"><code><div>[Unit]
Description=Inicializa o script firewall automaticamente.
After=network.target

[Install]
WantedBy=multi-user.target

[Service]
Type=oneshot
ExecStart=/usr/<span class="hljs-built_in">local</span>/sbin/firewall start
ExecStop=/usr/<span class="hljs-built_in">local</span>/sbin/firewall stop
RemainAfterExit=<span class="hljs-literal">true</span>
KillMode=process
</div></code></pre>
<br>
<h4 id="recarregar-daemons-do-sistema">Recarregar daemons do sistema</h4>
<pre class="hljs"><code><div>sudo systemctl daemon-reload
</div></code></pre>
<br>
<h4 id="ativar-o-servi%C3%A7o-do-firewall">Ativar o serviço do firewall</h4>
<pre class="hljs"><code><div>sudo systemctl <span class="hljs-built_in">enable</span> firewall.service
</div></code></pre>
<br>
<br>
<h2 id="proxy-squid">Proxy Squid</h2>
<h3 id="instalar-o-squid3-e-apache2">Instalar o Squid3 e Apache2</h3>
<pre class="hljs"><code><div>sudo apt install squid3 apache2
</div></code></pre>
<br>
<h3 id="arquivo-de-configura%C3%A7%C3%A3o-do-squid">Arquivo de Configuração do Squid</h3>
<pre class="hljs"><code><div>sudo vi /etc/squid/squid.conf
</div></code></pre>
<p>conteúdo do arquivo:</p>
<pre class="hljs"><code><div><span class="hljs-comment">#==  ACL's padrao  ============================================================#</span>
acl SSL_ports port 443 563 873                                                        
acl Safe_ports port 80 21 443 70 210 280 488 591 777 8080 3128                    
acl Safe_ports port 1025-65535
acl CONNECT method CONNECT

<span class="hljs-comment">#==============================================================================#</span>

<span class="hljs-comment"># Diretorio de erros PT|BR</span>
error_directory /usr/share/squid/errors/pt-br
access_log /var/<span class="hljs-built_in">log</span>/squid/access.log

<span class="hljs-comment"># Configuracao de cache de memoria de disco</span>
cache_mem 2500 MB
maximum_object_size_in_memory 1 MB
cache_log /var/<span class="hljs-built_in">log</span>/squid/cache.log

<span class="hljs-comment"># Definicoes de cache no disco</span>
maximum_object_size 25 MB
maximum_object_size 1 KB
cache_dir ufs /etc/squid/cache 15360 16 128

<span class="hljs-comment"># Substituicao do cache</span>
cache_swap_low 80
cache_swap_high 90

<span class="hljs-comment"># Sarg</span>
acl sarg dst 192.168.15.254
http_access allow sarg

<span class="hljs-comment">#==  ACL's  ===================================================================#</span>
acl localnet src 192.168.15.0/24
acl negados url_regex -i <span class="hljs-string">"/etc/squid/files/negados.acl"</span>
 
<span class="hljs-comment">#==  DEFAULT HTTP-ACCESS  ====================================================#</span>
http_access deny !Safe_ports
http_access deny CONNECT !SSL_ports
http_access allow localhost manager
http_access deny manager
http_access allow localhost

<span class="hljs-comment">#==  HTTP-ACCESS  ============================================================#</span>
http_access allow localnet !negados

<span class="hljs-comment">#==  DENY ALL  ===============================================================#</span>
http_access deny all    
visible_hostname proxy_server
http_port 192.168.15.254:3128

<span class="hljs-comment">#============================================================================#</span>
coredump_dir /var/spool/squid
refresh_pattern ^ftp:       1440    20% 10080
refresh_pattern ^gopher:    1440    0%  1440
refresh_pattern -i (/cgi-bin/|\?) 0 0%  0
refresh_pattern (Release|Packages(.gz)*)$      0       20%     2880
refresh_pattern .       0   20% 4320
</div></code></pre>
<br>
<h3 id="pasta-de-cache-do-squid">Pasta de Cache do Squid</h3>
<pre class="hljs"><code><div><span class="hljs-comment"># Criar a pasta cache</span>
sudo mkdir /etc/squid/cache
<span class="hljs-comment"># Dar permissão total</span>
sudo chmod 777 /etc/squid/cache
<span class="hljs-comment"># Parar o Squid</span>
sudo service squid stop
<span class="hljs-comment"># criar o banco de dados de cache do Squid</span>
sudo squid -z
<span class="hljs-comment"># Reinicia o Squid</span>
sudo service squid restart
</div></code></pre>
<br>
<h3 id="p%C3%A1gina-de-acesso-negado">Página de Acesso Negado</h3>
<pre class="hljs"><code><div>sudo vi /usr/share/squid/errors/pt-br/ERR_ACCESS_DENIED
</div></code></pre>
<p>conteúdo do arquivo:</p>
<pre class="hljs"><code><div><span class="hljs-meta">&lt;!DOCTYPE  <span class="hljs-meta-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span>  <span class="hljs-attr">lang</span>=<span class="hljs-string">"pt-br"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">meta</span>  <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span>  /&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">meta</span>  <span class="hljs-attr">name</span>=<span class="hljs-string">"viewport"</span>  <span class="hljs-attr">content</span>=<span class="hljs-string">"width=device-width, initial-scale=1.0"</span>  /&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Ooops!<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">link</span>  <span class="hljs-attr">rel</span>=<span class="hljs-string">"shortcut icon"</span>  <span class="hljs-attr">href</span>=<span class="hljs-string">"faviconWhite.ico"</span>  <span class="hljs-attr">type</span>=<span class="hljs-string">"image/x-icon"</span>  /&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span>
@import  url("https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&amp;display=swap");

*  {
margin:  0;
padding:  0;
box-sizing:  border-box;
}

html,
body  {
font-family:  "Poppins"  Arial,  Helvetica,  sans-serif;
font-size:  16px;
}
  
body  {
background-color:  rgb(240,  240,  240);
display:  flex;
height:  100vh;
justify-content:  center;
align-items:  center;
}
  
#container  {
height:  60vh;
width:  80vw;
background-color:  rgb(253,  253,  253);
border-radius:  40px;
box-shadow:  6px  6px  22px  -4px  rgba(72,  72,  72,  0.1);
padding:  108px  110px  60px  128px;
} 

#main-text  {
display:  flex;
justify-content:  space-between;
flex-direction:  column;
gap:  60px;
}

#footer  {
display:  flex;
flex-direction:  row;
justify-content:  space-between;
align-items:  center;
}
  
#main  {
display:  flex;
flex-direction:  column;
justify-content:  space-between;
height:  100%;
}

h1  {
font-size:  70px;
font-weight:  bold;
}

p  {
font-size:  20px;
font-weight:  500;
line-height:  28px;
}

a  {
font-weight:  600;
text-decoration:  none;
pointer-events:  stroke;
 
&amp;:active {
color: rgb(201,  154,  237);
}
}
  
img  {
filter:  grayscale();
height:  40px;
}
<span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
	<span class="hljs-tag">&lt;<span class="hljs-name">div</span>  <span class="hljs-attr">id</span>=<span class="hljs-string">"container"</span>&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-name">div</span>  <span class="hljs-attr">id</span>=<span class="hljs-string">"main"</span>&gt;</span>
			<span class="hljs-tag">&lt;<span class="hljs-name">div</span>  <span class="hljs-attr">id</span>=<span class="hljs-string">"main-text"</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>Ooops!<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
				<span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>
				Este site foi bloqueado pela ConectaNet por violar nossas políticas
				de uso.<span class="hljs-tag">&lt;<span class="hljs-name">br</span>  /&gt;</span>Para mais informações,
				<span class="hljs-tag">&lt;<span class="hljs-name">a</span>  <span class="hljs-attr">href</span>=<span class="hljs-string">""</span>&gt;</span>entre em contato conosco<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>.
				<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
			<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
			<span class="hljs-tag">&lt;<span class="hljs-name">div</span>  <span class="hljs-attr">id</span>=<span class="hljs-string">"footer"</span>&gt;</span>
				<span class="hljs-tag">&lt;<span class="hljs-name">small</span>&gt;</span>Atenciosamente, Equipe de TI da ConectaNet<span class="hljs-tag">&lt;/<span class="hljs-name">small</span>&gt;</span>
				<span class="hljs-tag">&lt;<span class="hljs-name">img</span>  <span class="hljs-attr">src</span>=<span class="hljs-string">"logo-transparent.png"</span>  <span class="hljs-attr">alt</span>=<span class="hljs-string">"Logo ConectaNet"</span>  /&gt;</span>
			<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
		<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
	<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</div></code></pre>
<br>
<h3 id="criar-pasta-files-e-arquivo-negadosacl">Criar pasta <code>files</code> e arquivo <code>negados.acl</code></h3>
<pre class="hljs"><code><div>sudo mkdir /etc/squid/files
sudo touch /etc/squid/files/negados.acl
</div></code></pre>
<br>
<h3 id="reiniciar-o-squid">Reiniciar o Squid</h3>
<pre class="hljs"><code><div>sudo service squid restart
</div></code></pre>
<br>
<br>
<h2 id="sarg">Sarg</h2>
<h3 id="instalar-o-sarg">Instalar o Sarg</h3>
<pre class="hljs"><code><div>sudo apt install sarg
</div></code></pre>
<br>
<h3 id="arquivo-de-configura%C3%A7%C3%A3o-do-sarg">Arquivo de configuração do Sarg</h3>
<pre class="hljs"><code><div>sudo vi /etc/sarg/sarg.conf
</div></code></pre>
<p>conteúdo do arquivo:</p>
<pre class="hljs"><code><div><span class="hljs-comment"># Arquivo de configuração do SARG para análise de logs do Squid</span>

<span class="hljs-comment"># Localização do arquivo de log de acesso do Squid</span>
access_log /var/<span class="hljs-built_in">log</span>/squid/access.log

<span class="hljs-comment"># Título da página de relatórios</span>
title <span class="hljs-string">"Logs de acesso do Squid"</span>

<span class="hljs-comment"># Fonte para o texto</span>
font_face Tahoma,Verdana,Arial

<span class="hljs-comment"># Cor do cabeçalho</span>
header_color <span class="hljs-comment">#000</span>

<span class="hljs-comment"># Cor de fundo do cabeçalho</span>
header_bgcolor <span class="hljs-comment">#c9b2ed</span>

<span class="hljs-comment"># Tamanho da fonte</span>
font_size 14px

<span class="hljs-comment"># Tamanho da fonte do cabeçalho</span>
header_font_size 14px

<span class="hljs-comment"># Tamanho da fonte do título</span>
title_font_size 14px

<span class="hljs-comment"># Cor de fundo do texto</span>
background_color <span class="hljs-comment">#f3f3f3</span>

<span class="hljs-comment"># Cor do texto</span>
text_color <span class="hljs-comment">#000</span>

<span class="hljs-comment"># Cor de fundo do texto</span>
text_bgcolor lavender

<span class="hljs-comment"># Cor do título</span>
title_color <span class="hljs-comment">#966ccc</span>

<span class="hljs-comment"># URL da imagem do logotipo</span>
logo_image https://i.postimg.cc/Gtq5tfNL/logo-transparent.png

<span class="hljs-comment"># Texto do logotipo</span>
logo_text <span class="hljs-string">"ConectaNet Reports"</span>

<span class="hljs-comment"># Cor do texto do logotipo</span>
logo_text_color <span class="hljs-comment">#966ccc</span>

<span class="hljs-comment"># Diretório temporário</span>
temporary_dir /tmp

<span class="hljs-comment"># Diretório de saída dos relatórios</span>
output_dir /var/www/html/squid-reports

<span class="hljs-comment"># Resolver IPs</span>
resolve_ip no

<span class="hljs-comment"># Exibir IPs do usuário</span>
user_ip no

<span class="hljs-comment"># Campo de ordenação para os principais usuários</span>
topuser_sort_field BYTES reverse

<span class="hljs-comment"># Campo de ordenação para os usuários</span>
user_sort_field BYTES reverse

<span class="hljs-comment"># Arquivo de exclusão de usuários</span>
exclude_users /etc/sarg/exclude_users

<span class="hljs-comment"># Arquivo de exclusão de hosts</span>
exclude_hosts /etc/sarg/exclude_hosts

<span class="hljs-comment"># Formato da data</span>
date_format u

<span class="hljs-comment"># Último log</span>
lastlog 0

<span class="hljs-comment"># Remover arquivos temporários</span>
remove_temp_files yes

<span class="hljs-comment"># Indexar os relatórios</span>
index yes

<span class="hljs-comment"># Organização dos índices em árvore de arquivos</span>
index_tree file

<span class="hljs-comment"># Sobrescrever relatórios existentes</span>
overwrite_report yes

<span class="hljs-comment"># Registros sem identificação de usuário</span>
records_without_userid ip

<span class="hljs-comment"># Utilizar vírgula como separador</span>
use_comma yes

<span class="hljs-comment"># Utilitário de e-mail</span>
mail_utility mailx

<span class="hljs-comment"># Número de principais sites</span>
topsites_num 100

<span class="hljs-comment"># Ordem de classificação dos principais sites</span>
topsites_sort_order CONNECT D

<span class="hljs-comment"># Ordem de classificação do índice</span>
index_sort_order D

<span class="hljs-comment"># Códigos de exclusão</span>
exclude_codes /etc/sarg/exclude_codes

<span class="hljs-comment"># Tempo máximo de duração</span>
max_elapsed 28800000

<span class="hljs-comment"># Tipo de relatório</span>
report_type topusers topsites sites_users users_sites date_time denied auth_failures site_user_time_date downloads

<span class="hljs-comment"># Arquivo de tabela de usuários</span>
usertab /etc/sarg/usertab

<span class="hljs-comment"># URLs longas</span>
long_url no

<span class="hljs-comment"># Data e hora por bytes</span>
date_time_by bytes

<span class="hljs-comment"># Conjunto de caracteres</span>
charset Latin1

<span class="hljs-comment"># Exibir mensagem de sucesso</span>
show_successful_message no

<span class="hljs-comment"># Exibir estatísticas de leitura</span>
show_read_statistics no

<span class="hljs-comment"># Campos do relatório de principais usuários</span>
topuser_fields NUM DATE_TIME USERID CONNECT BYTES %BYTES IN-CACHE-OUT USED_TIME MILISEC %TIME TOTAL AVERAGE

<span class="hljs-comment"># Campos do relatório de usuários</span>
user_report_fields CONNECT BYTES %BYTES IN-CACHE-OUT USED_TIME MILISEC %TIME TOTAL AVERAGE

<span class="hljs-comment"># Número de principais usuários</span>
topuser_num 0

<span class="hljs-comment"># Exibir logotipo do SARG</span>
show_sarg_logo no

<span class="hljs-comment"># Arquivo CSS externo</span>
external_css_file http://192.168.15.254/squid-reports/style.css

<span class="hljs-comment"># Sufixo para download</span>
download_suffix <span class="hljs-string">"zip,arj,bzip,gz,ace,doc,iso,adt,bin,cab,com,dot,drv$,lha,lzh,mdb,mso,ppt,rtf,src,shs,sys,exe,dll,mp3,avi,mpg,mpeg"</span>

</div></code></pre>
<br>
<br>
<h2 id="dhcp">DHCP</h2>
<h3 id="instalar-o-isc-dhcp-server">Instalar o isc-dhcp-server</h3>
<pre class="hljs"><code><div>sudo apt install isc-dhcp-server
</div></code></pre>
<br>
<h3 id="configurar-o-arquivo-etcdhcpdhcpdconf">Configurar o arquivo /etc/dhcp/dhcpd.conf</h3>
<p>conteúdo do arquivo:</p>
<pre class="hljs"><code><div><span class="hljs-comment"># Configuração do serviço DHCP.</span>
authoritative;
subnet 192.168.15.0 netmask 255.255.255.0 {
        range 192.168.15.10 192.168.15.200;
        option domain-name-servers 192.168.15.254, 192.168.3.254, 8.8.8.8, 1.1.1.1;
        option domain-name <span class="hljs-string">"srv-dhcp.conecta.net"</span>;
        option subnet-mask 255.255.255.0;
        option routers 192.168.15.254;
        option broadcast-address 192.168.15.255;
        default-lease-time 600;
        max-lease-time 7200;
        }
</div></code></pre>
<br>
<h3 id="configurar-interface-para-execu%C3%A7%C3%A3o-do-dhcp">Configurar interface para execução do DHCP</h3>
<pre class="hljs"><code><div>sudo vi /etc/default/isc-dhcp-server
</div></code></pre>
<p>conteúdo do arquivo:</p>
<pre class="hljs"><code><div>arquivo isc-dhcp-server aqui
</div></code></pre>
<br>
<h3 id="reiniciar-o-servi%C3%A7o-isc-dhcp-server">Reiniciar o serviço isc-dhcp-server</h3>
<pre class="hljs"><code><div>sudo service isc-dhcp-server restart
</div></code></pre>
<br>
<br>
<h2 id="ad-samba-ad-dc">AD (samba-ad-dc)</h2>

</body>
</html>
